---
layout: single
title: "é€šè¿‡å ¡å’æœºé€æ˜è¿æ¥åˆ°äº‘ä¸­ä»»æ„å†…ç½‘ä¸»æœº"
date: 2018-07-17 08:20:00 +0800
Author: hedzr
tags: [linux, ssh, login, bastion, devops]
categories: devops linux ssh
comments: true
toc: true
header:
  overlay_image: /assets/images/whats-devops.jpg
  overlay_filter: rgba(32, 32, 0, 0.5)
#excerpt: "BASH å°æŠ€å·§ä¸€å°ç»„ [...]"
#header:
#  overlay_image: /assets/images/unsplash-image-1.jpg
#  overlay_filter: rgba(0, 0, 0, 0.15)
#  caption: "Photo credit: [**Unsplash**](https://unsplash.com)"
#  actions:
#    - label: "More Info"
#      url: "https://unsplash.com"
---



é€šè¿‡å ¡å’æœºé€æ˜è¿æ¥åˆ°äº‘ä¸­ä»»æ„å†…ç½‘ä¸»æœºï¼Œä¸”è‡ªç”±åˆ‡æ¢åˆ°å…¶ä»–ä¸»æœºã€‚

é€‚åˆäºå„ç§å…¬æœ‰äº‘ç¯å¢ƒã€‚

<!--MORE--> 

### å‰ç½®æ¡ä»¶

ä½ çš„SSHè¯ä¹¦åœ¨æ¯ä¸€å°ä¸»æœºä¸Šéƒ½æœ‰ç›¸åŒçš„è´¦æˆ·åä»¥åŠæ§åˆ¶å°ç™»å½•æˆæƒã€‚

è¿™ä¸€ç‚¹å…¶å®ä¸æ€ä¹ˆå®¹æ˜“ï¼Œæ¯”è¾ƒå¯è¡Œçš„æ–¹æ³•æœ‰ï¼š

- é€šè¿‡è‡ªå®šä¹‰é•œåƒé¢„å…ˆåšå¥½è´¦æˆ·åï¼Œå¹¶ç”¨è¯¥é•œåƒå¼€æœº
- é€šè¿‡ä¸€å¥—opsè„šæœ¬é›†ï¼Œåœ¨æ¯å°ä¸»æœºä¸Šæ‰§è¡Œä¸€æ¬¡ç‰¹å®šå­åŠŸèƒ½ä»¥ä¾¿å»ºç«‹ç›¸åŒçš„è´¦æˆ·åä»¥åŠæˆæƒ
- é€šè¿‡ansibleæˆ–ç±»ä¼¼çš„éƒ¨ç½²å·¥å…·ï¼Œæ‰§è¡Œä¸“ç”¨è„šæœ¬ä»¥ä¾¿å»ºç«‹è´¦æˆ·å

å…³äºå‰ç½®æ¡ä»¶çš„å®ç°ï¼Œä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒç•´ï¼Œå› æ­¤è¿™é‡Œä¸å†å±•å¼€ç»†èŠ‚äº†ã€‚

 

### æœ¬æœº

ä½ çš„å·¥ä½œä¸»æœºéœ€è¦æœ‰ä¸€ç‚¹å‡†å¤‡ï¼šè¯·ä¿®æ”¹ ~/.bashrc è¿½åŠ å¦‚ä¸‹è¯­å¥ï¼š

```
ssh -add -K ~/.ssh/id_rsa
alias ssh='ssh -A'
```

ä»¥ä¸Šæˆ‘ä»¬å‡å®šä½ çš„ä¸»åŠ›SSHè¯ä¹¦å°±æ˜¯å½“å‰è´¦æˆ·çš„ç¼ºçœè¯ä¹¦ï¼Œå¦åˆ™ä½ éœ€è¦æŒ‡å®šæ­£ç¡®çš„è¯ä¹¦è·¯å¾„ã€‚

ä¸Šé¢çš„è¯­å¥å°†ä¼šåœ¨SSHä¼šè¯ä¸­æºå¸¦ä½ çš„è¯ä¹¦åˆ°ä»»æ„ä½ç½®ï¼Œå½“ç„¶ä½ ä¹Ÿå¹¶ä¸å¿…æ‹…å¿ƒè¯ä¹¦çš„æ³„éœ²é—®é¢˜ï¼Œä½ çš„è¯ä¹¦åªä¼šå­˜åœ¨åœ¨å†…å­˜ä¸­ã€‚

 

### å ¡å’æœº

å‡å®šå‰ç½®æ¡ä»¶æ˜¯æ»¡è¶³çš„ï¼Œä¾‹å¦‚å·²ç»åœ¨æŸä¸ªæ–°çš„VPCä¸­å‡†å¤‡å¥½äº†è‡ªå®šä¹‰é•œåƒï¼Œå¹¶ä¸”æ–°å¼€ç¬¬ä¸€å°ä¸»æœºä½œä¸ºå ¡å’æœºï¼Œå¹¶ä¸”ä¸»æœºåå‘½åä¸º cx1ops00ï¼Œé‚£ä¹ˆ

```
ssh cx1ops00
```

åº”è¯¥èƒ½é¡ºåˆ©ç™»å½•åˆ°è¯¥ä¸»æœºã€‚

å ¡å’æœºéœ€è¦å¼€å¯SSHè½¬å‘ï¼Œå¯ä»¥ä¿®æ”¹å ¡å’æœºçš„ /etc/ssh/ssh_config åŠ å…¥ï¼š

```
Host cc*
    ForwardAgent yes
```

ä¹Ÿå¯ä»¥å»ºç«‹ ~/.ssh/config åŠ å…¥è¯¥é…ç½®ã€‚

 

### å…¶å®ƒå†…ç½‘ä¸»æœº

ä½ å¯ä»¥ç»§ç»­å¼€å…¶å®ƒä¸»æœºï¼Œè¿™äº›ä¸»æœºéƒ½å‘½åä¸º cc1xxxxxxï¼Œæ³¨æ„æ¯å°ä¸»æœºçš„ä¸»æœºåå’ŒIPåœ°å€éœ€è¦è¢«å†™å…¥å ¡å’æœºçš„ /etc/hosts æ–‡ä»¶ä¸­ï¼Œæˆ–è€…æ˜¯å†™å…¥åˆ° å†…ç½‘DNSæœåŠ¡å™¨ä¸­ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬é€šè¿‡æ–°å»ºä¸»æœºæ—¶çš„ç”¨æˆ·è‡ªå®šä¹‰å¯åŠ¨è„šæœ¬æ¥å®Œæˆè¯¥å·¥ä½œã€‚

 

### å›åˆ°æœ¬æœº

æˆ‘ä»¬ç°åœ¨éœ€è¦å®Œæˆé€šé…ç¬¦é…ç½®ï¼Œä¿®æ”¹ ~/.ssh/config åŠ å…¥å¦‚ä¸‹çš„é…ç½®æ–‡æœ¬ï¼š

```
Host cc*
    PreferredAuthentications publickey
    IdentityFile ~/.ssh/qcloud/tencent-cloud-newEcsDefault.dms
    ProxyCommand ssh cx1ops00 exec nc %h %p
```

> ä¸€æ ·çš„é“ç†ï¼Œè¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ä½ è‡ªå·±ä¿®æ­£æ­£ç¡®ã€‚

é€šè¿‡ä¸Šé¢çš„é€šé…ç¬¦é…ç½®ï¼Œæˆ‘ä»¬çº¦å®šå‡¡æ˜¯sshåˆ°äº‘ä¸»æœºå cc* çš„ï¼Œä¸€å¾‹å€ŸåŠ©å ¡å’æœº cx1ops00 è½¬å‘åˆ°äº‘ç«¯ï¼Œè‡³äºç¡®åˆ‡çš„äº‘ä¸»æœºåçš„æ­£ç¡®è§£é‡Šï¼Œåˆ™äº¤åˆ°å ¡å’æœºä¸Šå»å®Œæˆã€‚å› æ­¤ï¼Œç°åœ¨åœ¨æœ¬æœºä¸Šé€šè¿‡ ssh cc1web01 å¯ä»¥ç›´æ¥è¿æ¥åˆ°äº‘ä¸Šçš„å†…ç½‘ä¸»æœºäº†ã€‚

é€šè¿‡å ¡å’æœºçš„è¿æ¥ï¼Œæœ‰ä¸€å¼ å›¾ï¼Œæš‚æ—¶æ²¡æœ‰å¯»æ‰¾åˆ°åŸå§‹æ¥æºï¼š

[![img](/assets/images/ssh-connection-through-1.png)](http://blog.hedzr.com/wp-content/uploads/2018/07/ssh-connection-through-1.png)

 

### åè®°

ä¸Šé¢çš„æ–¹æ³•ï¼Œæ˜¯ç”¨åœ¨æˆ‘å·¥ä½œä¸­çš„æ–¹æ³•ã€‚çš„ç¡®å®ƒæ˜¯éœ€è¦è‹¥å¹²æ¡ä»¶ï¼Œä¸è¿‡å½“æˆ‘ä»¬æ¢³ç†æ¸…æ¥šå¹¶ä¸”æ‰¹é‡åº”ç”¨å‡ºå»äº†ä¹‹åï¼Œç°åœ¨å»æœåŠ¡å™¨ä¸Šæºœè¾¾ä¸€ä¸‹å·²ç»æˆäº†äº«å—äº†ï¼Œæ²¡æœ‰ä»€ä¹ˆå¯æŠµè§¦çš„äº†ã€‚

 





## ğŸ”š
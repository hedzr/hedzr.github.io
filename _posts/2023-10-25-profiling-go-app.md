---
layout: single
title: 'é«˜æ•ˆ Golang ç¼–ç ç‚¹æ»´é”±é“¢'
date: 2023-10-24 05:00:00 +0800
last_modified_at: 2023-10-25 12:00:00 +0800
Author: hedzr
tags: [golang, profiling, pprof]
categories: golang profiling
comments: true
toc: true
header:
  teaser: https://cdn.jsdelivr.net/gh/hzimg/blog-pics@master/uPic/image-20231026110402900.png
  overlay_image: /assets/images/unsplash-image-3.jpg
  overlay_filter: rgba(128, 128, 0, 0.3)
excerpt: >-
  è°ˆè®º Golang ä»£ç ä¼˜åŒ–é—®é¢˜ï¼Œç½—åˆ—ä¸€äº›å¸¸è§æ‰‹æ®µå…³äº optimizations, è°ƒä¼˜ï¼Œç­‰ç­‰ ...
---



Golang å¼€å‘æ—¶ï¼Œå‡å°‘ä¸å¿…è¦çš„èµ„æºã€ç®—åŠ›è¦æ±‚ï¼Œæ˜¯ä¸€ç§ç¤¼è²Œã€‚

ä¸æ˜¯è¯´å› ä¸ºå†…å­˜ã€SSD ç°åœ¨å¤šä¾¿å®œå•Šå°±è¯´å«©ä¸ªå¤§æ•°ç»„æä¸ªå¾ªç¯æœ‰å•¥å…³ç³»å•Šï¼Œèƒ½å¤Ÿç”¨ hashmap çš„åœ°æ–¹è¿˜æ˜¯åº”è¯¥é‡‡ç”¨å‡ ä¹ç›´æ¥å‘½ä¸­çš„æ–¹æ¡ˆè€Œä¸æ˜¯éå†æ•´ä¸ªé›†åˆçš„ç­–ç•¥çš„ã€‚

è¿™åŸæœ¬è¯¥æ˜¯ä¸€ç§ç¤¼è²Œçš„ã€‚

å¯æƒœçš„æ˜¯å®Œå…¨æ— çŸ¥çš„äººæ„è¯†ä¸åˆ°é‚£é‡Œä¸æ˜¯è’åŸï¼Œä¹Ÿä¸åº”è¯¥å› ä¸ºæ˜¯è’åŸå°±å¯ä»¥ä¹±æ‰”åƒåœ¾å¯¹ä¸ã€‚



## Profiling

Profiling and Tune/Optimizing æ˜¯ç¼–ç¨‹ä¸­ä¾‹è¡Œçš„ç ”ç©¶æ‰‹æ®µï¼Œç”¨æ—¶é«¦çš„è¯æ¥è¯´å°±æ˜¯è¿™æ˜¯ä¸€ç§æ´è§èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ´å¯Ÿä»£ç ä¸­çš„ä¸ä¼˜é›…ä¹‹å¤„ä»¥ä¾¿äºˆä»¥æ”¹æ­£ã€‚

å®é™…ä¸Šå¾ˆå¤šç¼–ç¨‹æƒ¯ä¾‹éƒ½æ˜¯æœ‰ç« å¯å¾ªçš„ï¼Œç›´æ¥å°±èƒ½å†™å‡ºæ¥ï¼Œè€Œééœ€è¦æ—¶å€™ pprof æ‰¾åˆ°ç“¶é¢ˆæ‰æ¥ä¿®è®¢ä»£ç ã€‚

æ‰€ä»¥ä¸‹é¢æ€»ç»“ä¸€äº›æƒ¯ä¾‹å‡ºæ¥ï¼ŒåŸºæœ¬ä¸Šåˆ°å¤„éƒ½æœ‰ä¸åŒå½¢å¼åœ°æè¿‡ã€è®ºè¿°è¿‡ã€è®²è§£è¿‡è¿™äº›æ‰‹æ®µï¼Œä¸è¿‡æˆ‘è¿™è¾¹å°±ä¼šåŠ ä¸Šæˆ‘çš„æ€è€ƒæ¥å¸®åŠ©ä½ çŸ¥å…¶ç„¶ä¸”çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œç”šè€Œè‡³äºèƒ½å¤Ÿæ¨åŠæœªæœ‰ç½—åˆ—çš„å…¶å®ƒåœºæ™¯ã€‚

> ä¾‹å¦‚é«˜æ•ˆçš„è¿æ¥å­—ç¬¦ä¸²å’Œ rune å­—ç¬¦ï¼Œä¹Ÿæœ‰å…¶æƒ¯ç”¨æ³•çš„ï¼Œå’Œä¸‹æ–‡çš„æ–¹æ¡ˆå¤§åŒå°å¼‚ï¼Œä½†æ˜¯å°±ä¸å¿…å•å¼€å°èŠ‚æ¥è®²äº†ã€‚
>
> çœŸè¦è®²èµ·æ¥ï¼ŒåŒºåŒºä¸€ç¯‡æ–‡ç« æ€ä¹ˆå¯èƒ½ï¼Ÿ
>
> ç°åœ¨çš„ä»»ä½•ä¸€ä¸ªæ‰€è°“çš„ä¼˜åŒ–ï¼ŒèƒŒåéƒ½æ˜¯æ•°åå¹´æ¥è®¡ç®—æœºç³»ç»Ÿæ¼”è¿›å†å²ï¼ŒPL æ¼”è¿›å†å²çš„æµ“ç¼©ã€‚å°åˆ°ä¸€ä¸ª 8 bytes å¯¹é½åè¾¹å°±æ¶‰åŠå¾—åˆ° CPU çš„æ•´ä¸ªæ¼”è¿›å†å²ã€‚
>
> æ‰€ä»¥æ¨è€Œå¹¿ä¹‹ã€ä¸¾ä¸€åä¸‰çš„èƒ½åŠ›ä½ å¿…é¡»æœ‰ã€‚

å¥½ï¼Œä¸‹é¢ä¸€ä¸€åˆ—ä¸¾ä¸€ä¸‹ã€‚

### å°½å¯èƒ½åœ°å°†ç»“æ„æŒ‡é’ˆæ¢ä¸ºç»“æ„ä½“

å’Œä¸€èˆ¬çš„ C++ è€æ‰‹çš„ç›´è§‰å®Œå…¨ä¸åŒï¼Œç»™å‡½æ•°ä¼ é€’ç»“æ„ä½“åœ¨ C++ é‡Œé¢æ˜¯å¾ˆå‚»çš„è¡Œä¸ºï¼Œå› ä¸ºè¿™å¸¦æ¥éšå«çš„ç»“æ„ä½“å¹³å‡¡æ‹·è´ï¼ˆ[Trivial Copy](https://en.cppreference.com/w/cpp/named_req/TriviallyCopyable)ï¼ŒæŒ‰ä½æŒ‰å­—èŠ‚å¤åˆ¶ç»“æ„ä½“æœ¬èº«ï¼Œå¯¹äºæŒ‡é’ˆæˆå‘˜ä»…å¤åˆ¶æŒ‡é’ˆæœ¬èº«ï¼Œè€Œä¸åˆ¶ä½œæŒ‡é’ˆæ‰€æŒ‡å‘çš„å¯¹è±¡çš„å‰¯æœ¬ï¼‰ï¼Œæ‰€ä»¥è€å¼çš„ C++ ç¨‹åºå‘˜ä¼šè®°å¾—ä¼ é€’ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè€Œå–„ç”¨æ–°é£æ ¼çš„åˆ™æ›´æ„¿æ„ä½¿ç”¨ç»“æ„ä½“çš„å¼•ç”¨ï¼Œç‰¹åˆ«æ˜¯ const æ–¹å¼çš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼š

```c++
#include <string>
#include <regex>

void replace(std::string const& str, std::string const& find, std::string const& repl) std::string {
  return std::regex_replace(str, std::regex(find), repl);
}
```

> ä¸Šé¢ä»£ç ä»…ä½œç¤ºæ„ï¼Œæœªç»è¿‡ç¼–è¯‘è¿è¡Œå’Œæµ‹è¯•ï¼Œå¯èƒ½å­˜åœ¨è®°å¿†æ··æ·†å¸¦æ¥çš„é‡å­æ‰°ä¹±ã€‚

åœ¨ Golang ä¸­ï¼Œæƒ…å†µæ°å¥½ç›¸åã€‚é¦–å…ˆä¸€ä¸ªä¸åŒåœ¨äºï¼ŒGolang ä¼ é€’ä¸€ä¸ªç»“æ„ä½“æ—¶ä¹Ÿä¸è¿‡å°±æ˜¯ä¼ é€’å…¶å®é™…å†…å­˜åœ°å€[^1]ï¼Œè¿™ç›¸å½“äºæ˜¯ä¸€ä¸ªæŒ‡é’ˆäº†ï¼Œä¹Ÿå¹¶ä¸åŒ…å«éšå«çš„å¹³å‡¡æ‹·è´è¡Œä¸ºã€‚å…¶æ¬¡ä¸€ä¸ªé—®é¢˜åœ¨äº GCã€‚åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç”±äº GC çš„é€ƒé€¸åˆ†æå¸¦æ¥çš„å‰¯ä½œç”¨ï¼Œæ‰€ä»¥ä¼ é€’æŒ‡é’ˆä½œä¸ºå‡½æ•°å‚æ•°ä¼šå¸¦æ¥é¢å¤–çš„é€ƒé€¸åˆ†æï¼Œå³éœ€è¦è·³è¿›åˆ°æŒ‡é’ˆæ‰€æŒ‡å¯¹è±¡ç»“æ„ä½“ä¸­æ‰«æé€ä¸ªæˆå‘˜ä»¥æ±‚å–å…¶å¼•ç”¨è®¡æ•°ã€‚è¿™ä½¿å¾— Golang æŒ‡é’ˆæ¯”è¾ƒç»“æ„ä½“æœ¬èº«éœ€è¦æ›´å¤šç®—åŠ›å’Œèµ„æºä½œä¸ºä»£ä»·ã€‚

> [^1]: æ­¤è¯´æ³•è¾ƒä¸ºç²—ç³™ï¼Œå®é™…æƒ…å†µéå¸¸å¤æ‚ã€‚ä»æ€»ä½“ç†è§£è§’åº¦ï¼Œä½ éœ€è¦çŸ¥é“ä¼ é€’ä¸€ä¸ªç»“æ„ä½“ä»£è¡¨ç€å¤åˆ¶è¡Œä¸ºï¼Œä½†ç”±äºä¼˜åŒ–å™¨çš„å­˜åœ¨ï¼Œå¤åˆ¶è¡Œä¸ºå¯èƒ½å¹¶ä¸ä¸€å®šæ€»æ˜¯ä¼šå‘ç”Ÿã€‚

ä»¥å‰æˆ‘å†™è¿‡ä¸€ç¯‡æ–‡ç«  [Golang - å…³äºæŒ‡é’ˆä¸æ€§èƒ½](https://hedzr.com/golang/pointer/go-pointer/) å®£ç§°è¯´èƒ½ç”¨æŒ‡é’ˆçš„æ—¶å€™ä¸€å¾‹ä½¿ç”¨æŒ‡é’ˆã€‚é‚£è¯ä¸èƒ½ç®—é”™ï¼Œå› ä¸ºåœºæ™¯ä¸åŒã€‚åœ¨å¸¸è§„ç¼–ç¨‹é¢†åŸŸï¼Œä½ é¦–å…ˆéœ€è¦å…³æ³¨è‡ªå·±çš„ç¼–ç¨‹ç›®æ ‡çš„è¾¾æˆï¼Œå³ä»£ç é€»è¾‘å’ŒåŠŸèƒ½æ­£ç¡®å®ç°ã€‚ä½¿ç”¨æŒ‡é’ˆä¼šä¸ºä½ æ¶ˆé™¤è¾ƒå¤šéšå¼çš„å‘ã€‚ä¾‹å¦‚å‡½æ•°ä¼ é€’ç»“æ„ä½“çš„ä»£ä»·åœ¨äºè¿™ä¸ªç»“æ„ä½“åœ¨å‡½æ•°ä½“ä¸­çš„ä¿®æ”¹æ˜¯ä¸èƒ½ååº”åˆ°è°ƒç”¨è€…çš„ï¼Œ

```go
package main

type A struct {
	F int
}

func Work(a A) {
	a.F = a.F + 1
}

func main() {
	var a = A{3}
	Work(a)
	println(a.F)
}

// Output:
// 3
```

è¿™ä¸ªç»“æœç†æ‰€å½“ç„¶ã€‚ä¸è¿‡ Golang åˆå­¦è€…ä¼šå› ä¸ºæ— æ„è¯†å¿½ç•¥è€Œå¿˜è®°æ£€æŸ¥ï¼Œæ­¤æ—¶ä»–ä»¬çš„æ„¿æ„å¯èƒ½å°±è¢«å‘æ‰äº†ã€‚

æˆ–è€…è¯´ï¼Œé‚£ç¯‡æ–‡ç« ä¸­çš„ææ³•ä¸å…æœ‰ç‚¹ç‰‡é¢ã€‚

ä¸è¿‡å€’ä¹Ÿæ— æ‰€è°“ã€‚



#### ä¸è¦åœ¨å‡½æ•°ä½“å†…ä¿®æ”¹åªè¯»çš„ç»“æ„ä½“å‚æ•°

è¿˜æ˜¯ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ï¼Œé—®é¢˜åœ¨ Work å‡½æ•°è¿™é‡Œå°±å¤æ‚åŒ–äº†ã€‚

æ­¤æ—¶ï¼ŒWork å‡½æ•°ä¸­ç»“æ„ä½“ç”±äºæˆå‘˜è¢«ä¿®æ”¹ï¼Œå› è€Œäº§ç”Ÿäº†ä¸€ä¸ªéšå¼çš„å‰¯æœ¬ï¼

è¿™ä¸ä½†å¸¦æ¥äº†é¢å¤–çš„ä¸€æ¬¡æ‹·è´ï¼Œå®é™…ä¸Šä¹Ÿå¢åŠ äº† GC åˆ†æçš„å·¥ä½œé‡[^2]ã€‚å¯ä»¥è¯´ä¸ä½†æ²¡èƒ½è·å¾—ç»“æ„ä½“ä¼ è¾“ç›¸æ¯”äºæŒ‡é’ˆå‚æ•°æ‰€å¸¦æ¥çš„ç›Šå¤„ï¼Œè¿˜å˜æœ¬åŠ å‰åœ°å¢åŠ äº†å¼€é”€ã€‚æ”¹æ­£çš„åŠæ³•æ˜¯é‡‡ç”¨æŒ‡é’ˆä½œä¸ºå‚æ•°[^3]ã€‚

> [^2]: æ˜¯å¦æ˜¯å› æ­¤äº§ç”Ÿçš„é¢å¤–çš„å·¥ä½œé‡éš¾ä»¥å®šè®ºã€‚ä½†æ˜¯ä¸€å®šä¼šå› æ­¤äº§ç”Ÿä¸´æ—¶å‰¯æœ¬ä¾›å­å‡½æ•°ä¿®æ”¹æ˜¯æ— ç–‘è®®çš„
> [^3]: æœªå¿…åªæœ‰è¿™ç§æ–¹æ³•ï¼Œè¡Œæ–‡ä»ç®€

```go
package main

type A struct {
	F int
}

func Work(a A) {
	a.F = a.F + 1
	println(a.F, &a.F)
}

func Work2(a &A) {
	a.F = a.F + 1
	println(a.F, &a.F)
}

func main() {
	var a = A{3}
	Work(a)
	println(a.F, &a.F)
  Work2(&a)
}

// Output (as a ref):
// 4 0xc00003e718
// 3 0xc00003e720
// 4 0xc00003e720
```

å¤šä¹ˆå¯æ‚²å•Šã€‚

æˆ–è€…è¯´ï¼ŒGolang æ˜¯å¤šä¹ˆå¯æ€œçš„ä¸€ç§å¼€å‘è¯­è¨€å•Šã€‚ä½†å‡¡ä½ çš„è®¡ç»„å­¦çš„å·®äº†ç‚¹ï¼Œä¹Ÿéƒ½ä¼šåœ¨ Go ä¸Šé¢æ­»å¾—èŠ±æ ·åœ°éš¾çœ‹ã€‚



#### ä¸å¾—ä¸ä½¿ç”¨æŒ‡é’ˆ

æ­¤å¤–ï¼Œ

æœ‰çš„åœºæ™¯æ˜¯å¿…é¡»æŒ‡é’ˆæ‰è¡Œçš„ã€‚

ä¸‹é¢å°±ç•¥ä½œæ¢è®¨ï¼Œä¹Ÿç®—æ˜¯è¡¥é½ä»¥å‰æ—§æ–‡ç« å¯¹æŒ‡é’ˆçš„æœªç«Ÿä¹‹å¤„å§ã€‚

é¦–å…ˆè¦çŸ¥é“çš„æ˜¯ï¼Œæ¥æ”¶è€…åªèƒ½æ˜¯æŒ‡é’ˆæ‰èƒ½ä¿®æ”¹æˆå‘˜å€¼çš„ã€‚

```go
type Int int

func (s Int) Set(i int) { s = i } // Wrong
func (s *Int) Set(i int) { *s = Int(i) } // It worked.

var i Int = 7
i.Set(8)
println(i)
```

Line 3 çš„å†™æ³•ä¹Ÿæ˜¯ä¸€ä¸ªå‘ï¼Œå®ƒèƒ½ç¼–è¯‘ï¼Œèƒ½è¿è¡Œï¼Œæ²¡æœ‰ä»»ä½•é”™è¯¯ï¼Œåªæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæœ¬å°Šçš„å€¼ä¸ä¼šè¢« Set(i) æ‰€ä¿®æ”¹ã€‚

è¦æƒ³è¾¾åˆ°ç›®çš„ï¼Œåªèƒ½é‡‡ç”¨æŒ‡é’ˆç‰ˆæœ¬çš„ receiverï¼ˆå¦‚åŒ Line 4 é‚£æ ·ï¼‰ã€‚

è¿›ä¸€æ­¥åœ°ï¼Œslice åœºæ™¯ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼šä½ ä¸ºä¸€ä¸ª Slice å£°æ˜äº†åˆ«åç±»å‹ï¼Œç„¶åæƒ³è¦ä¸ºå…¶é…å¤‡ä¸€äº›åŠŸèƒ½ï¼Œä¾‹å¦‚å¯¹ç»™å‡ºçš„å‚æ•°è¿›è¡Œè£…é¥°åå†è®¾ç½®åˆ° Slice ä¸­ï¼Œ

```go
type IS []int

func (s IS) Set(args ...int) {
  for _,v:=range args {
    s = append(s, v+1)
  }
}

var is = IS{2, 3}
is.Set(1, 2)
fmt.Println(is)

// Outputs:
// [2, 3]
```

æ­£ç¡®çš„æ–¹æ³•æ˜¯é‡‡ç”¨æŒ‡é’ˆç‰ˆæœ¬[^4]]ï¼Œç„¶åä¹¦å†™æ–¹å¼ä¸Šæœ‰ä¸€ç‚¹ç‚¹å°æŠ€å·§ï¼Œå³é€šè¿‡ `*s` æ¥è®¿é—® Slice æœ¬ä½“ã€‚

```go
type IS []int

func (s *IS) Set(args ...int) {
	for _, v := range args {
		*s = append(*s, v+1)
	}
}

var is = IS{2, 3}
is.Set(1, 2)
fmt.Println(is)

// Outputs:
// [2, 3, 2, 3]
```

[^4]: æ›´å¥½çš„ã€æ›´å¼¹æ€§çš„åšæ³•æ˜¯ä½¿ç”¨ `A struct { Items []int }` åŒ…è£…èµ·æ¥

å†è¿›ä¸€æ­¥ï¼ŒæŠŠç»“æ„ä½“ç”¨ä½œ map value æ—¶ï¼Œä½ æœ‰å¯èƒ½æ— æ³•åœ¨è¿­ä»£ä¸­ä¿®æ”¹ç»“æ„ä½“æˆå‘˜å€¼ã€‚ä¾‹å¦‚ï¼š

```go
var m1 = map[int]A{1: {4}}
for k, v := range m1 {
  if k == 1 {
    v.F *= 2
  }
}
fmt.Printf("%+v", m1[1])

// Output:
// &{F:4}
```

è§£å†³çš„åŠæ³•æ˜¯æŒ‡é’ˆ[^5]ï¼š

```go
var m1 = map[int]*A{1: {4}}
for k, v := range m1 {
  if k == 1 {
    v.F *= 2
  }
}
fmt.Printf("%+v", m1[1])

// Output:
// &{F:8}
```

[^5]:æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ `m[k] = v` çš„æ–¹æ³•å»å¼ºè¡Œä¿®è®¢ valueï¼Œä½†å¥½ä¸å¥½å°±éš¾ä»¥å®šè®ºäº†

#### å‡å°‘æŒ‡é’ˆé—´æ¥å¼•ç”¨ï¼Œå°½å¯èƒ½ä½¿ç”¨ copy å¼•ç”¨

å½“ç„¶ï¼Œæœ¬æ¡ç›®çš„ä¸»é¢˜è¿˜æ˜¯ä¼˜å…ˆä½¿ç”¨ copy å¼•ç”¨ä»¥è¾¾åˆ°æ€§èƒ½ä¼˜åŒ–çš„ç›®çš„ã€‚ä¾‹å¦‚ä½¿ç”¨ bytes.Bufferï¼Œè€Œä¸æ˜¯ä½¿ç”¨ *bytes.Bufferï¼Œå°½ç®¡ä¹¦å†™æ—¶ä¸¤è€…å¸¸å¸¸æ²¡æœ‰ä½¿ç”¨ä¸Šçš„åŒºåˆ«[^6][^7]ã€‚

[^6]: å¦‚å‰æ–‡æ‰€è¿°ï¼Œå¦‚æœä¼ é€’ç»™å­å‡½æ•°ï¼Œé‚£ä¹ˆä¹Ÿåªèƒ½æ˜¯æŒ‡é’ˆå½¢å¼äº†
[^7]: æˆ–è€…æ˜¯åŒ…è£¹åœ¨mapä¹‹ä¸­ï¼Œæˆ–è€…æ”¾åœ¨ä¸€ä¸ª struct é‡Œè¿›è¡Œä¼ é€’ï¼Œç„¶è€Œå®é™…ä¼ é€’çš„ map æ˜¯ä¸€ç§éšå¼æŒ‡é’ˆï¼Œæˆ–è€… *struct ä¹Ÿè¿˜æ˜¯éœ€è¦ä»¥æŒ‡é’ˆå½¢å¼ä¼ å‚

å‰é¢æåˆ°çš„å‡½æ•°ä¼ å‚ä½¿ç”¨ç»“æ„ä½“è€Œä¸æ˜¯ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œä¹Ÿæ˜¯ä¸ºäº†ä½¿ç”¨ copy å¼•ç”¨ã€‚éƒ½æ˜¯ä¸ºäº†æœ‰åˆ©äº gc åˆ†æã€‚

ç„¶åå‰é¢ä¹Ÿæåˆ°æ—§æ–‡ç«  [Golang - å…³äºæŒ‡é’ˆä¸æ€§èƒ½](https://hedzr.com/golang/pointer/go-pointer/) å®£ç§°å‡½æ•°ä¼ å‚ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆæ‰æ˜¯æ¨èçš„ï¼Œå› ä¸ºè¿™å¯ä»¥é¿å…ç»“æ„ä½“çš„å¤åˆ¶ã€‚è¿™ä¸€ç‚¹ï¼Œæœ¬æ–‡ä¸­æ•£ä¹±åœ¨å„ç§çš„è§£è¯´èƒ½å¤Ÿç»™ä½ å…¨è²Œï¼š

- æ˜¯çš„ï¼ŒæŒ‡é’ˆé¿å…ç»“æ„ä½“å¤åˆ¶ï¼Œä½†å¤åˆ¶å¹¶ä¸ä¼šæ€»æ˜¯å‘ç”Ÿ[^8]ã€‚é™¤éä½ åœ¨å‡½æ•°ä½“ä¸­ä¿®æ”¹äº†ç»“æ„ä½“æˆå‘˜ï¼Œå¯¼è‡´ golang ä¸å¾—ä¸ä¸ºå…¶åˆ›å»ºä¸€ä¸ªæœ¬åœ°å‰¯æœ¬ï¼Œé‚£å°±å­˜åœ¨é¢å¤–ä»£ä»·çš„å¯èƒ½[^9]ã€‚å…¶å®ƒæƒ…å†µä¸‹ï¼Œæ˜¯å¦æ€»æ˜¯å¤åˆ¶æˆ‘æš‚æœªæœ‰å®šè®ºï¼Œå¯èƒ½éœ€è¦è¿½æº¯ golang è§„èŒƒæˆ–è€…æºä»£ç æ‰èƒ½ç¡®å®šã€‚å§‘ä¸”å¯ä»¥è®¤ä¸ºæ˜¯æ€»æ˜¯ä¼šå‘ç”Ÿå§ã€‚

- æŒ‡é’ˆå‚æ•°å¸¦æ¥é¢å¤–çš„ GC é€ƒé€¸åˆ†æå¼€é”€ï¼Œç©¶ç«Ÿå¤§ä¸å¤§ã€å€¼ä¸å€¼ï¼Œé‚£å°±æ˜¯ä¸€ä¸ªç¥å­¦é—®é¢˜ã€‚æ€ä¹ˆåŠï¼Œpprof å…·ä½“åˆ†æå’Œåˆ¤æ–­ã€‚å…¶å®æ™®é€šæƒ…å†µä¸‹ä¸è‡³äºä¸ºæ­¤å¤§åŠ¨å¹²æˆˆã€‚

- å¦‚æœç»“æ„ä½“è¶…çº§å¤§ï¼Œé‚£ä¹ˆ copy å¼•ç”¨åœ¨ GC ä¸Šçš„æ”¶ç›Šå¯èƒ½æŠµä¸è¿‡æŒ‡é’ˆä¼ é€’ï¼Œé‚£ä¹ˆæ­¤æ—¶å¯èƒ½ä½ è¿˜æ˜¯åº”è¯¥ä½¿ç”¨æŒ‡é’ˆä¼ å‚æ‰å¯¹ã€‚

- åœ¨ go æœ€æ–°çš„å‡ ä¸ªç‰ˆæœ¬é‡Œï¼Œæœ‰å„ç§å„æ ·çš„å¾®å‹ä¼˜åŒ–ã€‚ä¾‹å¦‚å°äº 16 bytes çš„ string å°†ä¸ä¼šå‘ç”Ÿå†…å­˜åˆ†é…ï¼Œç­‰ç­‰ã€‚

  > æˆ‘æƒ³è¯´ shitã€‚è™½ç„¶è¿™ç§ç‰¹æ€§å¥½å¾—å¾ˆï¼Œä½†æ˜¯å¤ªéšæ„äº†ã€‚

[^8]: å–å†³äºä¼˜åŒ–å™¨çš„ä¼˜åŒ–æ·±åº¦
[^9]: è¿™æœªå¿…æ˜¯çœŸçš„ï¼Œä¹Ÿæœªå¿…äº§ç”Ÿé¢å¤–ä»£ä»·ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªç†è§£å¯ä»¥æš‚æ—¶æ”¾åœ¨è¿™é‡Œ



### å°½å¯èƒ½å°†å¤šä¸ªå°å¯¹è±¡çš„æ„é€ åˆå¹¶ä¸ºå•ä¸€çš„ä¸€ä¸ªå¤§å¯¹è±¡

ä¸€ä¸ªå–„è‰¯çš„ç±»åº“å¯èƒ½å¹¿æ³›åœ°ä½¿ç”¨å¾ˆå¤šå°å¯¹è±¡ï¼Œå¹¶ä¸”æ¯ä¸ªå°å¯¹è±¡éƒ½æœ‰é…å¥—çš„ new å‡½æ•°ã€‚ç„¶åä¸‹é¢çš„ä»£ç å°±æ˜¾å¾—å¾ˆæ­£å¸¸ï¼š

```go
type Data struct {
  config *DataConfig
}

cfg := NewDataConfig(true, 1, "slow")
data = NewData(cfg)
```

è¿™å¹¶æ²¡æœ‰ä»€ä¹ˆä¸å¦¥ã€‚ä½†æ˜¯å®ƒçš„æ€§èƒ½å¼±äºï¼š

```go
data = &Data{
  config: &DataConfig{
    enabled: true,
    count: 1,
    mode: "slow",
  }
}
```

å¦‚æœæœ‰å¿…è¦ä¸”æœ‰èƒ½åŠ›ï¼Œé‚£ä¹ˆå°±ä¸è¦åˆ†ç¦»åœ°æ„é€ è¿™äº›æ‰€å±çš„å°å‹å¯¹è±¡ï¼Œè€Œæ˜¯å°†å…¶ç»„åˆåœ¨ä¸€èµ·ï¼Œä¸€æ¬¡æ€§åœ°å®Œæˆã€‚



### ç»“æ„ä½“çš„ align ä¼˜åŒ–

ç»“æ„ä½“ä¸­çš„æˆå‘˜çš„å¯¹é½ä¼˜åŒ–ï¼Œæ˜¯ lint ä¸­ä¸€ä¸ªå«æ··çš„ææ³•ã€‚åˆå­¦è€…å°¤å…¶æ˜¯ C++ ç¨‹åºå‘˜ä¼šå¯¹æ­¤è¿·æƒ‘ï¼Œå› ä¸º string å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆåœ¨ç»“æ„ä½“ä¸­å½“ç„¶æ˜¯å­—é•¿å¯¹é½çš„å‘€ã€‚

```go
type MyStruct struct { //nolint:govet //can be reordered
	id       uint64
	required string
	note     *string
}

```

è¿™ä¸ªç»“æ„ä½“ï¼ˆå»æ‰ nolint å®£å‘Šåï¼‰ä¼šå¾—åˆ° golangci-lint govet filedalignment çš„æŠ¥å‘Šï¼š

`````
fieldalignment: struct with 32 pointer bytes could be 16 (govet)
`````

å®é™…ä¸Šå‘¢ï¼Œfieldalignment è¿™ä¸ªå®¶ä¼™å¹¶ä¸æ˜¯çœŸçš„åœ¨åˆ†æç»“æ„ä½“çš„æˆå‘˜å˜é‡æ˜¯ä¸æ˜¯æœ‰æ•ˆåœ°å­—é•¿å¯¹é½äº†ã€‚å®ƒåšçš„äº‹æ˜¯ç ”ç©¶æˆå‘˜å˜é‡çš„æ’åˆ—é¡ºåºæ˜¯å¦æœ‰åˆ©äº GC æ‰«æä¾èµ–å…³ç³»ã€‚

æ‰€ä»¥è§£å†³çš„æ–¹æ³•å°±å¾ˆæ¸…æ¥šäº†ï¼Œå°†å¸¦æœ‰æŒ‡é’ˆçš„å­—æ®µå°½é‡æå‰ï¼Œéšå¼æŒ‡é’ˆçš„ç±»å‹ï¼ˆä¾‹å¦‚ stringï¼Œsliceï¼Œarrayï¼Œmap ç­‰ï¼‰ä¹Ÿå¦‚æ­¤ï¼Œé‚£ä¹ˆ GC åªéœ€è¦æ‰«æç»“æ„ä½“çš„å‰é¢è‹¥å¹²å­—èŠ‚å°±èƒ½åˆ¤æ–­ä¾èµ–å…³ç³»äº†ã€‚

ç›¸ååœ°ï¼Œå¦‚æœé¦–å…ˆæ‘†æ”¾å åœ°é¢ç§¯å¾ˆå¤§çš„å­—æ®µï¼Œé‚£ä¹ˆ GC å¯èƒ½ä¸å¾—ä¸éœ€è¦å…ˆéå†è¿™å—ç©ºé—´åæ‰èƒ½å‘ç° b æ˜¯éœ€è¦ç™»è®°ä¸€ä¸ªå¼•ç”¨è®¡æ•°çš„ï¼š

```go
// GC will scan all 808 bytes.
type gcNotOptimized struct {
  a [100]int64
  b *int64 
}
```

æ‰€ä»¥å®ƒçš„æ”¹è¿›åº”è¯¥æ˜¯ï¼š

```go
// GC will scan only 8 bytes.
type gcNotOptimized struct {
  b *int64 
  a [100]int64
}
```

è€Œå‰é¢çš„ä¾‹å­ MyStruct åº”è¯¥æ”¹å†™ä¸ºï¼š

```go
type MyStruct struct {
	note     *string  // æŒ‡é’ˆä¼˜å…ˆ
	required string   // éšå¼æŒ‡é’ˆæ¬¡ä¹‹
	id       uint64
}
```

å…³äº fieldalignment è¿˜æœ‰ä¸€äº›å¯ä»¥è®¨è®ºçš„ï¼Œæˆ–è€…ä¸‹æ¬¡å•ç‹¬ä¸€ç¯‡èŠä¸€èŠå§ã€‚







### é¢„åˆ†é…ç©ºé—´

å‰é¢çš„å­—ç¬¦ä¸²è¿æ¥ä¼˜åŒ–æç¤ºä¸­å·²ç»è®¨è®ºè¿‡ []byte çš„é¢„åˆ†é…äº†ã€‚

ä½†è¿™ä¸ªæŠ€å·§è¿˜åœ¨å¹¿æ³›çš„åœºæ™¯ä¸­å¯è¢«åº”ç”¨ã€‚

```go
type X struct {
    buf      []byte
    bufArray [16]byte // buf usually does not grow beyond 16 bytes.
}

func MakeX() *X {
    x := &X{}
    // Preinitialize buf with the backing array.
    x.buf = x.bufArray[:0]
    return x
}
```

è¿™é‡Œï¼Œä½¿ç”¨ `[16]byte` å°¤å…¶æ˜¯ CPU å­—é•¿å¯¹é½æˆ–è€… CPU æµæ°´çº¿é•¿å¯¹é½ï¼Œæˆ–è€…å†…å­˜æ€»çº¿å­—é•¿å¯¹é½ï¼Œæˆ–è€…å†…å­˜é¡µå¸§é•¿åº¦å¯¹é½ï¼ˆå¯¹äºä¸åŒçš„ç›®æ ‡çš„å¯¹è±¡ï¼Œå¸¸å¸¸æœ‰ 16 å­—èŠ‚ï¼Œ4K å­—èŠ‚ï¼Œ16K å­—èŠ‚ç­‰ç­‰ä¸åŒçš„é¡µå¸§æˆ–è€…ç±»ä¼¼é¡µå¸§çš„å¯¹é½å°ºåº¦ï¼Œå…·ä½“è¯­è¨€å…·ä½“ç›®æ ‡è®¾å¤‡å…·ä½“ç ”ç©¶ï¼‰ï¼Œå…¨éƒ½æ˜¯å¥½çš„æƒ³æ³•ï¼Œå¹¶ä¸”èƒ½å¤Ÿæœ‰æ•ˆæœã€‚è¿™æ–¹é¢çš„ç»†èŠ‚è¿›ä¸€æ­¥çš„ç ”ç©¶è¯·å¿˜é«˜æ€§èƒ½ç¼–ç¨‹ã€æ— é”ç¼–ç¨‹ã€é«˜é¢‘äº¤æ˜“æ–¹é¢æ·±å…¥ã€‚

å¦ä¸€ä¸ªæ¡ˆä¾‹æ˜¯æŠ½å–æ ˆå¸§ï¼š

```go
func getpc(skip int) (pc uintptr) {
	var pcs [1]uintptr
	runtime.Callers(skip+1, pcs[:])
	pc = pcs[0]
	return
}

func getpcsource(pc uintptr) Source {
	frames := runtime.CallersFrames([]uintptr{pc})
	frame, _ := frames.Next()
	return Source{
		Function: frame.Function,
		File:     checkpath(frame.File),
		Line:     frame.Line,
	}
}
```

è¿™é‡Œçš„ [1]uintptr æ˜¯æœ€ä¼˜åŒ–çš„æŠ½å–å…·ä½“ä¸€å¸§çš„åšæ³•ã€‚

å½“ç„¶ï¼Œæ¥ä¸‹æ¥çš„ getpcsource å‡½æ•°ä¹Ÿæ˜¯å®ç°çš„æä¸ºç²¾ç®€çš„äº†ã€‚è¿™ä¸€å¥—å®ç°æ¯”è¾ƒäº logrus çš„é€å¸§éå†ï¼Œåˆ†æ package name æ¥è·³è¿‡ logrus è‡ªèº«ä»£ç å¯»æ‰¾åˆ° caller çš„ç®—æ³•è¦é«˜æ•ˆçš„å¤šäº†ã€‚



### å±€éƒ¨å˜é‡èšé›†åˆ°ä¸€èµ·è¿›è¡Œå£°æ˜å’Œåˆå§‹åŒ–

è¿™ä¸ªæ€æƒ³ä¹Ÿåœ¨äºå‡å°‘å¯¹è±¡åˆ†é…ï¼Œå‡å°‘ gc ç»¼åˆå‹åŠ›ã€‚ä¾‹å¦‚ï¼š

```go
for k, v := range m {
  k, v = k, v
  go func() {
    // use k and v
  }()
}
```

ä¸å¾—ä¸è¯´è’å”é•œå•Šã€‚

å¯¹äºè¿™å¤šä¸ªå±€éƒ¨å˜é‡çš„æ•è·ï¼Œæ›´å¥½çš„åŠæ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªä¸´æ—¶ structï¼š

```go
for k, v := range m {
	x := struct{ k, v string }{k, v}   // copy for capturing by the goroutine
	go func() {
		// use x.k and x.v
	}()
}
```

è€Œä¸”ä¹Ÿå¯ä»¥ä¼ å…¥è€Œä¸æ˜¯æ•ä¿˜ï¼š

```go
for k, v := range m {
	go func(k, v string) {
		// use k and v
	}(k, v)
}
```



æ­¤å¤–ï¼Œä½¿ç”¨å¤šå˜é‡åŒæ—¶èµ‹å€¼ï¼Œç”¨ var() èšåˆå£°æ˜ï¼Œä¹Ÿéƒ½æœ‰åˆ©äº gc åˆ†æçš„å¥½å¤„ï¼Œå°½ç®¡å®ƒä»¬çš„å¥½å¤„å¾®ä¸è¶³é“ï¼š

```go
var k, v = 1, "str"

var (
  k = 1
  v = newData()
)
```



### é‡‡ç”¨æ›´æœ‰æ•ˆçš„å­—ç¬¦ä¸²è¿æ¥

ä»£ç ä¸­ç»å¸¸ä¼šå‘ç”Ÿè¿æ¥å­—ç¬¦ä¸²çš„éœ€æ±‚ï¼Œè¿™é€šå¸¸å¯ä»¥

1. ç›´æ¥ä½¿ç”¨ `+` è¿ç®—ç¬¦
2. ä½¿ç”¨ fmt.Sprintf
3. ä½¿ç”¨ strings.Builder
4. ä½¿ç”¨ bytes.Buffer

æˆ‘è¿™é‡Œä¸ç»™å‡ºåˆ†ææˆ–è€… bench è¯æ˜ï¼Œé‚£æœ‰ç‚¹å°é¢˜å¤§åšã€‚çœåŠ›ä¸€ç‚¹å‡ºç»“è®ºï¼Œä¸Šè¿°å››ç§åŠæ³•çš„å¸¸è§„å†™æ³•éƒ½ä¸æ˜¯ç‰¹åˆ«æ°å½“çš„é«˜æ•ˆè¿æ¥æ–¹æ¡ˆã€‚ä¾‹å¦‚ä¸‹é¢è¿™äº›å†™æ³•ï¼š

```go
var s1 = "This solution"
var s2 = " is pretty good."
var s3 = s1 + s2
var s4

// fmt.Sprintf å’Œ + éš¾åˆ†é«˜ä¸‹ï¼Œé™¤éå…·ä½“åœºæ™¯ profiling
s4 = fmt.Sprintf("%v%v", s1, s2)
s4 = fmt.Sprintf("%s%s", s1, s2) // ä¼˜äº %v

var s5 strings.Builder
s5.WriteString(s1)
s5.WriteString(s2)
var s6 = s5.String()

var s7 bytes.Buffer
s7.WriteString(s1)
s7.WriteString(s2)
var s8 = s7.String()
```

åœ¨é€šç”¨åœºæ™¯ä¸­ï¼Œbytes.Buffer æ¯”è¾ƒ strings.Builder æœ‰å¾®å°çš„ä¼˜åŠ¿ï¼Œä½†æœ‰æ—¶å€™åˆ™ä¼šæ›´å·®ã€‚ä½†ä¸¤è€…éƒ½æ¯” fmt æˆ–è€… + æ›´æœ‰æ•ˆç‡ã€‚

ç„¶è€Œï¼Œæ›´å¥½çš„æ–¹æ¡ˆæ˜¯å¦‚ä¸‹ä¸¤ä¸ªï¼š

1. å¯¹äºå­—ä¸²è¿½åŠ æ•°å­—ï¼Œä½¿ç”¨ strconv.AppendXXX å‡½æ•°æ—
2. å¯¹äºå­—ç¬¦ä¸²ã€rune çš„é€šç”¨è¿æ¥ï¼Œä½¿ç”¨é¢„åˆ†é…ç©ºé—´å appendï¼Œ
3. æˆ–è€…ä½¿ç”¨ strings.Builder.Grow / bytes.Buffer.Grow ç„¶åè¿½åŠ 

```go
buf := []byte("Size: ")
buf = strconv.AppendInt(buf, 85, 10)
buf = append(buf, " MB."...)
s := string(buf)
```

æ•ˆèƒ½æ›´é«˜çš„ï¼š

```go
roughSize = (6+2+4)*3 // ç²—ç•¥ä¼°ç®—ï¼Œè‡³å°‘å¤§äºå®é™…éœ€è¦çš„ä¸²é•¿
buf = make([]byte, 0, roughSize)
buf = append(buf, "Size: "...)
buf = strconv.AppendInt(buf, 85, 10)
buf = append(buf, " MB."...)
s := string(buf)
```

roughSize å¦‚æœèƒ½å¤Ÿæå‰ç²¾ç¡®è®¡ç®—é‚£å°±æ›´å¥½ã€‚å¦‚æœä¸èƒ½ï¼Œé‚£ä¹ˆä¹Ÿåº”ä¿è¯è‡³å°‘ä¼šå¤§äºå®é™…éœ€è¦çš„ä¸²é•¿ã€‚ç”±äº Golang å­—ç¬¦ä¸²é‡‡ç”¨ UTF-8 æ ¼å¼ï¼Œè¿™ç§ç¼–ç çš„ç‰¹ç‚¹æ˜¯å¯¹äºå…¨éƒ¨å­—å¹³é¢æ¥è®²å¹³å‡é•¿åº¦ä¸º 3 bytesï¼ˆç²—ç•¥åœ°ï¼‰ï¼Œæ‰€ä»¥ roughSize éœ€è¦ä¹˜ä»¥ 3 æ¥é€‚åº”å›½é™…åŒ–åœºæ™¯ã€‚å¦‚æœä½¿ç”¨ []rune åˆ™æ²¡æœ‰è¿™æ ·çš„å¿§è™‘ã€‚ä½†æ˜¯ä¸€åˆ‡å‡éœ€ä»¥ profiling ä¸ºè¯äº‹è€…ï¼Œè™½ç„¶å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸¤è€…çš„åŒºåˆ«ä¸å€¼å¾—è¦è·‘å‡ é progiliing æ¥åš deed hard ä¼˜åŒ–ã€‚

è¿™é‡Œçš„æ ¸å¿ƒæ€æƒ³åœ¨äº**æå‰ä¸€æ¬¡æ€§åˆ†é…æ‰€éœ€ç©ºé—´ï¼Œè€Œä¸æ˜¯åœ¨éœ€è¦æ—¶ä¸´æ—¶æ‰©å……**ï¼Œä¹Ÿå°±æ˜¯æå‰åšå•æ¬¡ growã€‚å¦‚æœæœ‰å¤§é‡å­—ç¬¦ä¸²ä¸²æ¥çš„éœ€æ±‚ï¼Œè¿™ä¸ªæ€æƒ³å¯ä»¥å¸¦æ¥æ˜¾è‘—çš„æ”¶ç›Šã€‚

ç±»ä¼¼åœ°ä¹Ÿå¯ä»¥ï¼š

```go
roughSize = (6+2+4)*3 // ç²—ç•¥ä¼°ç®—ï¼Œè‡³å°‘å¤§äºå®é™…éœ€è¦çš„ä¸²é•¿
var sb strings.Builder
sb.Grow(roughSize)
buf.WriteString("Size: ")
buf.WriteString(strconv.Itoa(buf, 85, 10))
buf.WriteString(" MB.")
s := string(buf)
```

å®ƒå’Œ append+strconv.AppendXXX çš„å·®è·ä¸å¤§ï¼Œæœ‰æ—¶å€™æ›´å®¹æ˜“é€‚åº”å¤æ‚åœºæ™¯ã€‚

[40+ practical string tips (cheat sheet)](https://yourbasic.org/golang/string-functions-reference-cheat-sheet/)



### é¼“åŠ±ä½¿ç”¨ sync.Pool

å°±æˆ‘ä¸ªäººè€Œè¨€å‘¢ï¼Œè¿™è¾ˆå­éƒ½ä¸å¯èƒ½ç”¨ sync.Pool çš„ã€‚

å“ˆå“ˆç©ç¬‘ä¸€ä¸ªã€‚

å®é™…ä¸Šå¾ˆå¤šäººéƒ½æ¨èä½¿ç”¨ sync.Pool çš„ã€‚è¿™ä¸ªæ•°æ®ç»“æ„åŸæœ¬æ˜¯ç”¨äºåˆ¶ä½œä¸€ä¸ªä¸´æ—¶å¯¹è±¡æ± ï¼Œå‡å°‘ä¸´æ—¶å¯¹è±¡çš„åˆ†é…ã€‚è¿™ç§ Pattern çš„æœ¬æ„æ˜¯ç”¨äºæ¯”æ–¹è¯´æ•°æ®åº“è¿æ¥å¯¹è±¡æ± ï¼Œä¸å¿…åœ¨éœ€è¦è¿æ¥æ—¶æ‰å‘æ•°æ®åº“å‘èµ·è¿æ¥è¯·æ±‚ï¼Œè€Œæ˜¯æå‰å‡†å¤‡å°±ç»ªï¼Œç«‹å³å–ç”¨ã€‚ç„¶åç°å®ç”Ÿæ´»ä¸­ï¼Œå®ƒè¢« gophers ä»¬ç”¨äºæå‰åˆ†é…å†…å­˜ï¼Œéœ€è¦çš„æ—¶å€™ç›´æ¥å–ç”¨ï¼Œç›®çš„åœ¨äºå‡å°‘é«˜é¢‘äº¤æ˜“æ—¶åˆ†é…å†…å­˜çš„å¼€é”€ï¼Œè¿›ä¸€æ­¥ç”±äºä¸å¿…é‡Šæ”¾å†…å­˜ï¼Œè¿˜é™ä½äº†å¯¹ GC çš„è¯·æ±‚é¢‘åº¦ï¼Œç¼“è§£äº† GC å‹åŠ›è¿‡é‡å¯¼è‡´çš„ CPU High Usages ä»¥åŠ app çš„ç¬æ—¶åœæ­¢åº”ç­”ï¼ˆç”±äºç®—åŠ›è¢«ç”¨äº GC å›æ”¶ï¼‰é—®é¢˜ã€‚

è¯¥è¯´ä»€ä¹ˆå‘¢ï¼Ÿ

è¿™å€’ä¹Ÿç®—ä¸å¾—è¯¯ç”¨æ»¥ç”¨ï¼Œåè€Œå¯èƒ½æ˜¯ä¸€ç§åˆç†çš„é€‰æ‹©ã€‚

è€Œä¸” syncPool è¿˜æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼Œå®ƒæ˜¯åŸå­çš„ï¼Œè¢«ç”¨åœ¨å¹¶å‘ç¼–ç¨‹ä¸­æ—¶çœå´å¾ˆå¤šâ€œå¿ƒæ™ºè´Ÿæ‹…â€ã€‚

æˆ‘ä¸ªäººä¹‹æ‰€ä»¥å¾ˆå°‘ç”¨åˆ°å®ƒï¼Œçº¯ç²¹æ˜¯å¾ˆå¤šæ—¶å€™æ— æ³•å¿å—æ³›å‹ç¼ºå¤±æˆ–è€…é˜‰å‰²æ³›å‹çš„ä¸‘é™‹å´åˆä¸æ„¿æ„ç­‰è€Œæ¬¡ä¹‹é€‰æ‹©ä¸€ä¸ªæ¬¡ä¼˜å“ä½œä¸ºä»£æ›¿ã€‚



### å…¶å®ƒçš„

fmtPrintf åŸºæœ¬ä¸Šæ˜¯ä»£ä»·è¾ƒä¸ºæ˜‚è´µçš„ä¸œè¥¿ï¼Œå®ƒçš„ `%v` å¾ˆå¥½ç”¨ï¼Œä½†æ˜¯ä¼šç”¨åˆ° reflectï¼Œé‚£æ›´æ˜¯ä¸ªæ€§èƒ½å‘è´§ã€‚

json ä¹‹ç±»çš„ä¸œè¥¿ï¼Œyaml æˆ–è€… toml ç­‰ç­‰ï¼Œå…¨éƒ½ä»£ä»·æ˜‚è´µã€‚

ç£ç›˜ I/O å°½å¯èƒ½ä½¿ç”¨ Buffered I/Oï¼Œè¿™ä¸ªå¸¦æ¥çš„ç›Šå¤„å¥½è¿‡è°ƒä¼˜å†…å­˜ã€‚

é‡‡ç”¨åŸ‹ç‚¹æ—¥å¿—æ–¹æ¡ˆï¼ˆå‚è€ƒæˆ‘çš„ [åœ¨ Go ä¸­å®ç°æ›´å¥½çš„åŸ‹ç‚¹æ—¥å¿—åŠŸèƒ½](https://hedzr.com/golang/logging/better-tracking-diagnosed-logging-in-go/)  ï¼‰ï¼Œç¼–è¯‘ release ç‰ˆæœ¬æ—¶å…³æ‰æ—¥å¿—ï¼Œå¯ä»¥å¤§å¹…åº¦æå‡æ€§èƒ½ã€‚å¦‚æœéœ€è¦è¿è¡Œæ—¥å¿—ï¼Œåœ¨ release ç‰ˆæœ¬ä¸­å°†å…¶æ”¹ä¸ºå¼‚æ­¥å†™å…¥ç£ç›˜æ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§é€‰é¡¹ã€‚

é¿å…ä½¿ç”¨ anyã€‚å¦‚æœæœ‰å¯èƒ½ï¼Œåˆ™ä½¿ç”¨ç¡®åˆ‡çš„æ•°æ®ç±»å‹ã€‚

ä¸ä½¿ç”¨ reflectã€‚

> ä¸ä½¿ç”¨ reflectï¼Œæœ‰æ—¶å€™å¯èƒ½åªæ˜¯ä¸€ç§å¥¢æœ›ã€‚å¤§å¤šæ•°éšå«å¤„ç†é€šç”¨æ•°æ®ç±»å‹çš„æœ‰ç”¨çš„å·¥å…·ï¼Œå…¨éƒ½é€ƒè„±ä¸äº† reflect æä¾›çš„èƒ½åŠ›ã€‚ä¾‹å¦‚ fmt.Printf("%v", v)ï¼Œjson åº“ï¼Œdeepcopy åº“ï¼Œconfig center/storeï¼Œpretty print ç­‰ç­‰ã€‚
>
> è‡³äºæ³›å‹ï¼Œæ²¡æœ‰ç»“æ„ä½“æˆå‘˜ï¼ˆå‡½æ•°ï¼‰çš„ç‹¬ç«‹çš„æ³›å‹èƒ½åŠ›ï¼Œç°åœ¨å¸‚é¢ä¸Šæä¾›çš„å„ç§æ³›å‹åº“å¸¸å¸¸åªèƒ½æ²¦ä¸ºç©å…·ã€‚ä½ è¿˜æ˜¯ä¸å¾—ä¸æ¡èµ· any å’Œ reflect æ¥å®Œæˆè‡ªå·±çš„ç¼–ç å·¥ä½œã€‚





## å®ä½œè¯´æ˜

åœ¨ Goland ä¸­ Bench with Profiling éå¸¸å®¹æ˜“ï¼Œä¹Ÿå¾ˆå®¹æ˜“æŸ¥çœ‹ pprof ç«ç„°å›¾ï¼Œä»¥åŠ Allocated Objects ç»Ÿè®¡è¡¨ã€‚

![image-20231026110402900](https://cdn.jsdelivr.net/gh/hzimg/blog-pics@master/uPic/image-20231026110402900.png)

> åœ¨ä¸€ä¸ª Test/Bench å‡½æ•°çš„å·¦ä¾§è¾¹æ ä¸Šç›´æ¥åšå¸¦æœ‰å†…å­˜åˆ†é…åˆ†æçš„ pprofï¼Œç›´æ¥å°±å¯ä»¥ã€‚
>
> vscode golang åœ¨ run a main function, test with profiling ä¸Šæ²¡æœ‰è¿™äº›èˆ’é€‚åº¦ã€‚
>
> vscode ä¹Ÿæ²¡æœ‰ run configï¼Œsaved run/debug config, pinnedï¼Œè¿™äº›éƒ½æ˜¯ Goland çš„ä¼˜åŠ¿ã€‚

æ‰€ä»¥æˆ‘éƒ½æ˜¯è¢«å…»åˆäº†ã€‚

æˆ‘æœ¬æ¥æ˜¯ä¸ªå¾ˆçº¯ç²¹çš„ Bash å…šã€‚ä½ å¯èƒ½çŸ¥é“æˆ‘å¹²è¿‡ä¸å°‘ DevOps çš„å·¥ä½œï¼Œç”šè‡³è¿˜ç»´æŠ¤äº†ä¸€ä¸ª bash å‡½æ•°é›†åˆä¸åŸºæœ¬æ¡†æ¶ [bash.sh](https://github.com/hedzr/bash.sh)ã€‚

æ‰€ä»¥ä»¥å‘½ä»¤è¡Œæ–¹å¼ä½¿ç”¨ pprof æˆ‘ä¹Ÿå¾ˆç†Ÿæ‚‰çš„ï¼Œå¥ˆä½•ï¼Œå°‘æŠ˜è…¾ä¹Ÿæ˜¯å¥½äº‹ã€‚å°‘æ•°æœ€å…³é”®çš„ pprof å‘½ä»¤è¡Œç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„æ—§æ–‡ç«  [Golang Profiling: å…³äº pprof](https://hedzr.com/golang/profiling/golang-pprof/) ï¼Œå®ƒä¸æ˜¯å‚è€ƒæ‰‹å†Œï¼Œé¡¶å¤šç®—ä¸ª cheetsheetï¼Œä¸´æ—¶å–ç”¨è¿˜æ˜¯æ–¹ä¾¿çš„ã€‚







## åè®°

æ”¾é£è‡ªæˆ‘æ—¶é—´åˆ°ï¼

### èŠæ¬¡ä¼˜å“é€‰æ‹©

å‰é¢æåˆ°æˆ‘ä¸çˆ±ç”¨ syncPoolã€‚

C++ åœ¨è¿™æ–¹é¢ç®€ç›´å®Œç¾ã€‚å°±æ˜¯è¯´ï¼ŒC++ éšæ‰‹æ’¸ä¸ª connectPool éƒ½å¯ä»¥æ€§èƒ½ã€ä¼˜é›…å°½çš†ä¸Šä½³çš„ç¨‹åº¦ï¼Œç¨‹åºå‘˜æœ‰å……åˆ†çš„æ“æ§èƒ½åŠ›ã€‚åŒæ—¶ï¼Œè¿˜æ˜¯ç±»å‹å®Œç¾æ³›åŒ–çš„ã€‚

å¼ºç±»å‹çš„æ³›åŒ–ï¼Œé‡‡ç”¨ C++ çš„é›¶æŠ½è±¡+ç¼–è¯‘æœŸè®¡ç®—æ€è·¯ï¼Œå¯ä»¥å¾—åˆ°æœ€ä½³æ€§èƒ½ï¼Œè¿˜å¯ä»¥è§„é¿äº†ç±»ä¼¼äº Golang interface{} çš„å°ç®±å¼€ç®±ä»£ä»·ã€‚C# å¦‚æ­¤çš„å®Œç¾ï¼Œä½†åœ¨åŸºæœ¬ç±»å‹ä¸Šçš„å°ç®±å¼€ç®±æ½œåœ¨ä»£ä»·ä¹Ÿè¿˜æ˜¯ä»¤äººä¸é€‚ã€‚ä½†æˆ‘æ²¡æœ‰ç ”ç©¶è¿‡ dotnetCore 3+ ä»¥åŠ dotnet 5\6\7 åœ¨å„ç§ç»†èŠ‚ä¸Šçš„ä¼˜åŒ–åŠ›åº¦ï¼Œå°±ä¸å¤šè¯´äº†ã€‚è€Œ Golang çš„æ³›å‹ï¼Œæ²¡æœ‰åŒ¿åå‡½æ•°æ³›åŒ–ï¼Œä»¥åŠæ–¹æ³•å‡½æ•°æ³›åŒ–ï¼Œé‚£è¿˜èƒ½åšä»€ä¹ˆï¼Ÿæˆ‘çš„å·¥ç¨‹åªéœ€è¦ä¸€ä¸ª Pool[T] å°±å¤Ÿäº†ä¹ˆï¼Ÿæ‰€ä»¥ç°åœ¨çš„ Golang è™½è¯´æœ‰äº†å¾ˆå¤šæ³›å‹åº“ï¼Œä½†å…¶å®å°±æ˜¯ä¸ªç©å…·ï¼Œåšåšæ¼”ç¤ºè¿˜å¯ä»¥ï¼Œå·¥ç¨‹ä¸­å®ç”¨ï¼Œä¹Ÿå°±åªèƒ½ minmax äº†ã€‚ä»€ä¹ˆæ—¶å€™æ ‡å‡†åº“æ³›å‹åŒ–äº†ï¼Œæ‰èƒ½è°ˆå·¥ç¨‹å®ä½œã€‚

æ‰€ä»¥æˆ‘çš„é€‰æ‹©æ˜¯è¿™ä¹ˆé«˜é¢‘çš„äº¤æ˜“é‚£å°±è¿˜æ˜¯ C++ å§ï¼Œå¦‚æœè¿˜ä¸æ»¡æ„ï¼Œé‚£å°± C å§ã€‚ä»€ä¹ˆ Golangï¼ŒPython éƒ½æ˜¯å¼±çˆ†äº†è¢«åŠæ‰“çš„å®¶ä¼™ä»€ã€‚

è‡³äº Rustï¼Œä½ å¯èƒ½æ³¨æ„åˆ°äº†æˆ‘ä»æ¥ä¸å†™ Rust çš„æŠ€æœ¯ç›¸å…³å†…å®¹ï¼Œå› ä¸ºè¿™ä¹Ÿæ˜¯ä¸ªä¸‘é™‹åˆ°çˆ†çš„å®¶ä¼™å‘€ï¼Œè€Œä¸”æˆ‘æœ€è®¨åŒæœ‰äººæŠŠæˆ‘å½“å‚»ç“œä¸€å‰¯ä¸ºæˆ‘å¥½çš„å˜´è„¸äº†ã€‚

å›å¿†ä»¥å‰ç”¨äº†å¥½å¤šå¹´æ‰å­¦ä¼š Javaï¼Œåæ¥æˆ‘æ€»ç»“ï¼Œä¸æ˜¯æˆ‘å¤ªç¬¨ï¼Œè€Œæ˜¯å¤ªç¬¨çš„è¯­è¨€æˆ‘ç¡®å®ä»å¿ƒåº•é‡ŒæŠµè§¦å®ƒæ‰€ä»¥å­¦ä¸ä¼šï¼Œ;Dã€‚è¿™å€’ä¸æ˜¯æˆ‘ä¸ºè‡ªå·±å¼€è„±ï¼ŒçœŸå“’ï¼å®åœ¨æ˜¯å®Œç¾ä¸»ä¹‰è€…å¿…ä¼šå¦‚æ­¤ï¼Œå¿ä¸ä¸‹å»æ€ä¹ˆåŠå‘¢å¯¹ä¸å¯¹ã€‚æˆ‘ä¸€ç›´ä¹Ÿæœ‰è®¡åˆ’æƒ³åšä¸€é—¨è‡ªå·±ä¸“å±çš„è¯­è¨€ï¼ˆC++ æˆ‘ä¸æ»¡çš„åœ°æ–¹ä¹Ÿå¤šäº†å»äº†ï¼Œç‰¹åˆ«æ˜¯ç°åœ¨è¿™äº›ç‰¹æ€§éƒ½é‚£ä¹ˆå¼‚å½¢ï¼Œlambda è¯­æ³•å¦‚æ­¤ä¸‘é™‹ï¼ŒShitï¼Œåæ¥æˆ‘è‡ªå·±è®¾æƒ³ C++ å¢åŠ  lambfa ä¹Ÿæ²¡æƒ³å‡ºæ¥æ¼‚äº®è¶…è¿‡ Kotlin çš„è¯­æ³•ï¼Œä¹Ÿå°±ä½œç½¢äº†ï¼‰ï¼Œå“ï¼Œå¯æƒœè¿™ç§å·¥ç¨‹çœŸçš„å¤ªåºå¤§ï¼Œåˆéš¾ä»¥æŠŠè¿™æƒ³æ³•æ‹¿æ¥åˆä½œï¼Œä¼—å£éš¾è°ƒï¼Œé‚£æ—¶å€™åšå‡ºæ¥çš„æ–° PL è¿˜æ˜¯æˆ‘æƒ³è¦çš„é‚£ä¸ªå—ã€‚åªèƒ½æç½®ä¸‹å»äº†ã€‚

ç„¶åå›å¿†å­¦äº†å¥½å‡ å¹´ Rustï¼Œä¹Ÿä¸èƒ½è¯´ä¸ä¼šï¼Œä½†æ˜¯è¡·å¿ƒåœ°éš¾å—å•Šï¼Œå¾ªç¯å¼•ç”¨ææ­»äººã€‚æˆ‘ä¸èƒ½åƒé‚£æ ·åœ°ç”Ÿæ´»ï¼Œæˆ‘ç¡®ä¿¡æ˜¯å¦‚æ­¤çš„ã€‚æˆ‘å­¦è®¡ç®—æœºçš„åˆå¿ƒæ˜¯å•¥å“©ï¼Œä¸å°±æ˜¯èƒ½å¤Ÿæ“æ§è®¡ç®—æœºå—ï¼Œæ•´å‡ºä¸ªè¯­è¨€æ¥æ“æ§æˆ‘ã€æŠŠæˆ‘å½“ä½œåˆä¸­äºŒå¹´çº§èˆ¬çš„å‘µæŠ¤ï¼Œæˆ‘è°¢è°¢ä½ å–ï¼Œé‚£å°±è¿˜æ˜¯ç®—äº†å§ã€‚



### èŠä¸çŸ¥é“ä»€ä¹ˆ

å‰é¢ä¹Ÿè¯´åˆ°äº†è‹¥å¹² C++ ç¨‹åºå‘˜åœ¨ Golang ä¸Šçš„éš¾çœ‹çš„æ­»ç›¸ã€‚

æˆ‘å°±æ˜¯ä¸€è·¯è¸©å‘ä¸Šæ¥çš„ã€‚

æˆ‘ä¸€ç›´åœ¨ç­¹å¤‡æƒ³è¦æŠŠ [cmdr](https://github,cin/hedzr/cmdr) é‡å†™ä¸€éï¼ŒæŠŠé‚£äº›æ‹™ç¬¨çš„ç»†èŠ‚ç»™æŠ¹äº†å»ã€‚ç„¶è€Œå› ä¸ºä¸€äº›ä¸ªåŸå› ï¼Œè¿™ä¸¤å¹´æ²¡æœ‰ä»€ä¹ˆæ•´å—çš„æ—¶é—´èƒ½å¤Ÿé™å¿ƒç¼–ç ï¼Œå°±ä¸€ç›´æç½®ã€‚æ‰€å¹¸åŠŸèƒ½ä¸Š cmdr è¿˜æ˜¯æœ‰è‡ªå·±çš„ç‰¹ç‚¹çš„ã€‚è€Œä¸”å…¶å®å³ä½¿æœªæ¥å‡çº§ v2 äº†ï¼Œé‚£äº› ugly çš„ä»£ç ä¹Ÿæ¶ˆå¤±ä¸äº†äº†ï¼Œå®ƒä»¬éƒ½æˆä¸ºé»‘å†å²éšè—åœ¨å¹³æ—¶ä¸å¯è§ä¹‹å¤„ï¼Œç¨ç¨ç”¨å¿ƒç¿»ä¸€ç¿»ä¾ç„¶èƒ½å¤ŸæŠ½å‡ºæ¥ã€‚è¯´åˆ°è¿™é‡Œè¿˜è¦è¯´ç‚¹é¢å¤–çš„è¯ï¼Œæˆ‘éƒ½ä¸æ‹…å¿ƒåˆ«äººç¿»æˆ‘çš„é»‘å†å²ï¼Œæ¯•ç«Ÿæˆ‘çš„é¡¹ç›®æ²¡åæ°”ï¼Œæˆ‘ä¹Ÿä¸æ˜¯ä»€ä¹ˆæœ‰åæ°”çš„äººç‰©ï¼Œæˆ‘ä¹Ÿä¸å–œæ¬¢æœ‰åæ°”ï¼Œæˆ‘æ›´å–œæ¬¢æ”¾ä¸€å †äººä¸­é—´æ‰¾ä¸å‡ºæ¥çš„æ•ˆæœï¼Œé‚£è°ä¼šæ¥ä¸“é—¨è·Ÿæˆ‘è¿‡ä¸å»å‘¢æ˜¯ä¸æ˜¯ï¼Œè¿™æˆæœ¬ä¹Ÿä¸åˆ’ç®—å•Šã€‚ç„¶è€Œï¼ŒAI å’Œä½ è®²ä»€ä¹ˆæˆæœ¬ï¼Ÿï¼å®ƒä¼šæŠŠæˆ‘çš„ä»£ç ä»ä»“åº“é‡Œç¿»æ£€å‡ºæ¥ååå¤å¤åœ°ç ”ç©¶ã€è®¡ç®—ï¼Œsome day åœ¨æŸæœ¬ AI æ•™ç§‘ä¹¦é‡Œé¢å°±èƒ½ä½œä¸ºç»å…¸åé¢æ¡ˆä¾‹ç»™å…¬ç¤ºå‡ºæ¥ï¼ŒTM ä¸‹é¢è¿˜ä¼šç”¨å°å­—ä½“ç»™å‡ºä¸€ä¸ªé“¾æ¥ï¼Œç›´è¾¾æˆ‘çš„ GH repo source code source lineã€‚å“å˜›çš„ï¼Œè¶Šæƒ³è¶Šä¸èˆ’æœæ–¯åŸºã€‚

ç”±æ­¤ï¼Œæˆ‘ä¹Ÿä¼šå¯¹ Dave ç­‰çœŸæ­£çš„å¤§ä½¬ä½©æœçš„ç´§ï¼Œä»–ä»¬ç»™å‡ºçš„ä»£ç æ€»æ˜¯èƒ½å¤Ÿæˆä¸ºæ­£é¢èŒƒæœ¬ï¼Œä»æœªæœ‰ä»€ä¹ˆè¿‡äº†ä¸¤å¹´æˆ‘æ‡‚çš„åˆå¤šäº†ï¼Œä»£ç å†™çš„æ›´å¥½äº†çš„è¯´æ³•ã€‚æ¢å¥è¯è¯´ï¼Œä»–ä»¬çš„ä»£ç æ°´å¹³æ²¡æœ‰å­¦ä¹ å’Œæå‡ä¸€è¯´ï¼Œä¸€ç›´éƒ½åœ¨å·…å³°é«˜ä½ã€‚

è¿™æ˜¯ä¸æ˜¯ä¹ŸæŒºææ€–çš„ã€‚

éƒ½è¯´åˆ°è¿™é‡Œäº†ï¼Œç»§ç»­å¯¹ AI å—¤ä¹‹ä»¥é¼»ã€‚è®²çœŸï¼Œæˆ‘ä¸æ˜¯ä¸€ä¸ªäººï¼Œæˆ‘çš„çœ¼é‡Œå¸‚é¢ä¸Šçš„ AI èƒ½å«ä»€ä¹ˆ AIï¼Œå…¨éƒ½æ˜¯å‚»å­ã€‚70ï½90å¹´ä»£ç†è®ºç•Œå’Œå·¥ä¸šç•Œéƒ½æ¯”è¾ƒæ·³æœ´ï¼Œä»–ä»¬è®²äººå·¥æ™ºèƒ½æ—¶ï¼Œä¼šè°ˆè®ºç­‰æ•ˆæ™ºåŠ›ï¼Œæ‰€ä»¥å¼ºäººå·¥æ™ºèƒ½è‹¥èƒ½è¾¾åˆ° 4 å²å°å­©æ°´å¹³é‚£å°±è¶³å¤Ÿ OK äº†ã€‚ä½†å½“ä¸‹çš„ AI è¦è°ˆæ™ºåŠ›å²‚éå¯ç¬‘ã€‚æ‰€ä»¥ç°åœ¨èµ„æœ¬çš„çœ¼å…‰åˆåœ¨çœ‹ AGI äº†ã€‚å…¶å®éƒ½æ˜¯æ— èŠçš„ä¸œè¥¿ã€‚æŒ‰ç…§æˆ‘ä¸ªäººç§ä¸‹çš„çœ‹æ³•ï¼Œå†¯æ°è®¡ç®—ä½“ç³»ä¸‹é¢æœºå™¨è¦è¯ç”Ÿæ™ºæ…§ï¼Œåº”è¯¥æ˜¯ä¸å¯èƒ½çš„äº‹æƒ…ã€‚æœªæ¥ï¼Œç”šè‡³ä¹Ÿè®¸å°±æ˜¯æ˜å¹´ï¼Œä¸åŒçš„è®¡ç®—æ¨¡å¼ä¸‹è¯ç”ŸçœŸæ­£çš„äººå·¥æ™ºèƒ½è¯´ä¸å®šå°±ä¼šå‘ç”Ÿï¼Œä½†é‚£è‚¯å®šæ˜¯ä¸åŒçš„ç³»ç»Ÿæ¨¡å¼å’Œè®¡ç®—æ¨¡å¼äº†ã€‚æˆ‘å¾ˆä¹…ä»¥å‰ä» Prolog å¼€å§‹æ€è€ƒå¦‚ä½•è¾¾æˆå’Œåˆ›é€ æœºå™¨æ™ºèƒ½ï¼Œä½†æ•°åº¦æ€è€ƒå¤±è´¥çš„ç»“è®ºå°±æ˜¯ä¸Šé¢çš„çœ‹æ³•ï¼Œç°åœ¨çš„ CPUã€å†…å­˜ã€å¤–å­˜ è¿™æ ·çš„ç»„åˆï¼Œé€šè¿‡è®¡ç®—æ¥äº§ç”Ÿæ™ºæ…§ï¼Œè¿™åœ¨é€»è¾‘ä¸Šã€ç†è®ºä¸Šéƒ½æ˜¯ä¸å¯è¡Œçš„ã€‚æ™ºæ…§ï¼Œéœ€è¦ä¸€ç§æ— é™é€’å½’ä¸”èƒ½å¤Ÿè‡ªåŠ¨ä¸­æ–­çš„èƒ½åŠ›ï¼Œä»¥åŠä¸€ç§æ— é™å‘æ•£ç„¶åè‡ªåŠ¨å½’çº³çš„èƒ½åŠ›ï¼Œè¿™äº›èƒ½åŠ›æ˜¯å…ˆæœ‰è®¡ç®—ä½“ç³»æ‰€éš¾ä»¥å®ç°çš„ã€‚

æ”¶ï¼

æ‰€ä»¥ï¼Œæ—§æ–‡ç« å¦‚æœæœ‰é”™è¯¯ï¼Œæˆ‘ä¹Ÿä¸è®¢æ­£äº†ï¼Œé¡¶å¤šå†™ç¯‡æ–°çš„ã€‚

> ä½†æ˜¯ï¼Œä¸¤å¤©åï¼Œæœ¬æ–‡æˆ‘æ¶‚æŠ¹äº†ä¸€ä¸‹ï¼Œå› ä¸ºæœ‰çš„ææ³•æœ‰ç‚¹ç²—ç³™ä¸å¤Ÿç²¾ç¡®ï¼Œéš¾å…æ˜¾å¾—å¤ªå¼±é¸¡ï¼Œæ‰€ä»¥ä½ æ‡‚çš„ï¼Œæˆ‘è¿˜æ˜¯ç²‰é¥°äº†å°‘å°‘ã€‚

åˆ«è¯´æˆ‘ä¸æ˜¯ä»€ä¹ˆå¤§ä½¬ã€‚å°±ç®—çœŸå¤§ä½¬çŠ¯é”™è¢«å–·çš„ä¹Ÿå¤šçš„æ˜¯ï¼Œæˆ‘é”™é”™é”™ç‚¹ä»€ä¹ˆçš„åˆæœ‰ä»€ä¹ˆäº†ã€‚

ä¸€ç¬‘è€Œè¿‡ã€‚



### REFs

ç¨å¾®åˆ—å‡ºä¸€ç‚¹ï¼Œ

- [Profiling Go Programs - The Go Programming Language](https://go.dev/blog/pprof)
- [Profile-guided optimization in Go 1.21 - The Go Programming Language](https://go.dev/blog/pgo)
- [Performance Measuring, Profiling, and Optimizing Tips for Go Web Applications - by Santosh Shrestha - wesionaryTEAM](https://articles.wesionary.team/performance-measuring-profiling-and-optimizing-tips-for-go-web-applications-20f2f812ff6e)
- [Optimising Go allocations using pprof](https://www.robustperception.io/optimising-go-allocations-using-pprof/)
- [Debugging performance issues in Go programs](https://software.intel.com/en-us/blogs/2014/05/10/debugging-performance-issues-in-go-programs)
- [Golang Slices And The Case Of The Missing Memory](http://openmymind.net/Go-Slices-And-The-Case-Of-The-Missing-Memory/)
- [Daily code optimization using benchmarks and profiling in Golang - Gophercon India 2016 talk - by karthic Rao - Medium](https://medium.com/@hackintoshrao/daily-code-optimization-using-benchmarks-and-profiling-in-golang-gophercon-india-2016-talk-874c8b4dc3c5) 

æ›´å¤šçš„è‡ªå·±æœå§





ğŸ”š
---
layout: single
title: 'Golangå¼€å‘ç¯å¢ƒä¸­çš„æŠ€å·§'
date: 2020-09-07 00:07:11 +0800
last_modified: 2020-09-07 00:29:11 +0800
Author: hedzr
tags: [development, skills, tricks]
categories: develop tricks
comments: true
toc: true
header:
  overlay_image: /assets/images/unsplash-image-1.jpg
  overlay_filter: rgba(128, 128, 0, 0.3)
excerpt: >-
  å¯¹äºGolang å¼€å‘ç¯å¢ƒç›¸å…³çš„å°çš„æŠ€å·§å¾ˆéš¾å†è¢«è®°ä½äº†ï¼Œæ‰€ä»¥åªå¥½æ”¶å½•åœ¨æŸå¤„ ...

#  caption: "Photo credit: [**Unsplash**](https://unsplash.com)"
#  actions:
#    - label: "More Info"
#      url: "https://unsplash.com"
---



# Golang å¼€å‘ç¯å¢ƒä¸­çš„æŠ€å·§

> å¯¹äºGolang å¼€å‘ç¯å¢ƒç›¸å…³çš„å°çš„æŠ€å·§å¾ˆéš¾å†è¢«è®°ä½äº†ï¼Œæ‰€ä»¥åªå¥½æ”¶å½•åœ¨æŸå¤„

>
>
>
>
> 







## Golang goarch list

https://stackoverflow.com/questions/20728767/all-possible-goos-value

Note that those values are defined in [`src/go/build/syslist.go`](https://github.com/golang/go/blob/master/src/go/build/syslist.go).

With Go 1.5 (Q3 2015), `GOARCH` will become *much* more complete.
See [commit 1eebb91](https://github.com/golang/go/commit/1eebb91a5828c26532125b9464c92f721cd79d0f) by [Minux Ma (`minux`)](https://github.com/minux)

> ## `go/build`: reserve `GOARCH` values for *all* common architectures
>
> Whenever we introduce a new `GOARCH`, older Go releases won't recognize them and this causes trouble for both our users and us (we need to add unnecessary build tags).
>
> Go 1.5 has introduced three new GOARCHes so far: `arm64 ppc64 ppc64le`, we can take the time to introduce GOARCHes for all common architectures that Go might support in the future to avoid the problem.

```golang
const goosList = "android darwin dragonfly freebsd linux nacl \ 
  netbsd openbsd plan9 solaris windows "

const goarchList = "386 amd64 amd64p32 arm arm64 ppc64 ppc64le \
   mips mipsle mips64 mips64le mips64p32 mips64p32le \ # (new)
   ppc s390 s390x sparc sparc64 " # (new)
```

The list is still being review in [Change 9644](https://go-review.googlesource.com/#/c/9644/), with comments like:

> I wouldn't bother with Itanium. It's basically a dead architecture.
> Plus, it's so hard to write a compiler for it that I really can't see it happening except as a labor of love, and nobody loves the Itanium.

The [**official documentation**](https://golang.org/doc/install/source#environment) now (GO 1.5+ Q3 2015) reflects that completed list.

------

Update 2018: as documented in [Giorgos Oikonomou](https://stackoverflow.com/users/1199408/giorgos-oikonomou)'s [answer](https://stackoverflow.com/a/50117892/6309), Go 1.7 (Q1 2016) has introduced the
**`go tool dist list`** command.
See [commit c3ecded](https://github.com/golang/go/commit/c3ecded729214abf8a146902741cd6f9d257f68c): it fixes [issue 12270](https://github.com/golang/go/issues/12270) opened in Q3 2015:

> To easier write tooling for cross compiling it would be good to programmatically get the possible combinations of GOOS and GOARCH.

This was implemented in [CL 19837](https://go-review.googlesource.com/c/go/+/19837)

> `cmd/dist`: introduce `list` subcommand to list all supported platforms

You can list in plain text, or in json:

```golang
> go tool dist list -json
[
        {
                "GOOS": "android",
                "GOARCH": "386",
                "CgoSupported": true
        },
        ...
]
```

As [Mark Bates tweeted](https://twitter.com/markbates/status/1177326527287107585):

> Bonus: Column output properly formatted for display:
>
> ```golang
> go tool dist list | column -c 75 | column -t
> ```





## Golang Build Tags

build tags,

build constraints,



Excersices

- https://www.digitalocean.com/community/tutorials/customizing-go-binaries-with-build-tags

Official

- https://golang.org/pkg/go/build/ : [go/build](http://golang.org/pkg/go/build/#pkg-overview) from Go Document

Refs

- ~~https://stackoverflow.com/questions/15214459/how-to-properly-use-build-tags~~
- [Dave Cheney: Using //+build to swtich between debug and release builds](http://dave.cheney.net/2014/09/28/using-build-to-switch-between-debug-and-release)
- 
- [http://stackoverflow.com/questions/15214459/how-to-properly-use-build-tags](https://stackoverflow.com/questions/15214459/how-to-properly-use-build-tags)
- [http://stackoverflow.com/questions/11354518/golang-application-auto-build-versioning](https://stackoverflow.com/questions/11354518/golang-application-auto-build-versioning)
- http://codegangsta.io/blog/2013/07/11/practical-go-build-tags/
- http://technosophos.com/2014/06/11/compile-time-string-in-go.html
- 
- https://ijayer.github.io/post/tech/code/golang/20180623-go_cmd_01_1_go-build-constraint/



åœ¨ `src/go/build/build.go` ä¸­ï¼Œctxt.BuildTags åˆ—ä¸¾äº†å…¨éƒ¨å¯ç”¨çš„å†…ç½®çš„ Tagsã€‚



### è¯­æ³•è§„åˆ™

https://studygolang.com/articles/19280

1ï¼‰åªå…è®¸æ˜¯å­—æ¯æ•°å­—æˆ–_

2ï¼‰å¤šä¸ªæ¡ä»¶ä¹‹é—´ï¼Œç©ºæ ¼è¡¨ç¤ºORï¼›é€—å·è¡¨ç¤ºANDï¼›å¹å·(!)è¡¨ç¤ºNOT

3ï¼‰ä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ª+buildï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»æ˜¯ANDã€‚å¦‚ï¼š

```
// +build linux darwin
// +build 386
ç­‰ä»·äº
// +build (linux OR darwin) AND 386
```

4ï¼‰é¢„å®šä¹‰äº†ä¸€äº›æ¡ä»¶ï¼š
runtime.GOOSã€runtime.GOARCHã€compilerï¼ˆgcæˆ–gccgoï¼‰ã€cgoã€context.BuildTagsä¸­çš„å…¶ä»–å•è¯

5ï¼‰å¦‚æœä¸€ä¸ªæ–‡ä»¶åï¼ˆä¸å«åç¼€ï¼‰ï¼Œä»¥ *_GOOS, *_GOARCH, æˆ– *_GOOS_GOARCHç»“å°¾ï¼Œå®ƒä»¬éšå¼åŒ…å«äº† æ„å»ºçº¦æŸ

6ï¼‰å½“ä¸æƒ³ç¼–è¯‘æŸä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥åŠ ä¸Š`// +build ignore`ã€‚è¿™é‡Œçš„`ignore`å¯ä»¥æ˜¯å…¶ä»–å•è¯ï¼Œåªæ˜¯`ignore`æ›´èƒ½è®©äººçŸ¥é“ä»€ä¹ˆæ„æ€

æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹`go/build/build.go`æ–‡ä»¶ä¸­`shouldBuild`å’Œ`match`æ–¹æ³•ã€‚









ğŸ”š
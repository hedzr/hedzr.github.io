---
layout: single
title: 'Shell - å…³äº Shebang'
date: 2020-12-12 00:00:00 +0800
last_modified_at: 2020-12-12 07:11:00 +0800
Author: hedzr
tags: [shell, shebang, hashbang, ]
categories: devops shell
comments: true
toc: true
header:
  overlay_image: /assets/images/bash-shell.png
  overlay_filter: rgba(255, 255, 255, 0.5)
excerpt: >-
  Shebang æ˜¯ä»€ä¹ˆï¼Œ...

---



# Shebang in Shell



> æŒ‰
>
> ä»¥å‰æˆ‘æ›¾ç»æ¦‚æ‹¬è¿‡ [HereDoc](/devops/shell/about-heredoc/)ï¼Œ[Grep](/devops/shell/things-about-grep/) ç­‰ç­‰ï¼Œä»Šæ¬¡å¯¹ Shebang åšä¸€ä¸ªæ¦‚æ‹¬ä»‹ç»ã€‚



## å¯¼è¨€



é¦–å…ˆä½ éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œåœ¨è®¡ç®—æœºé¢†åŸŸä¸­ï¼Œbang æ˜¯å¹å·â—ï¸çš„æ„æ€ï¼Œå®ƒçš„æœ¬æ„æ˜¯é‡å‡»ï¼Œæ‰€ä»¥ä¿šè¯­å¼•ç”³ä¸ºæ„Ÿå¹å·ã€‚

æ— è®ºä½ æ˜¯å¦çŸ¥é“ç”šè‡³æ˜¯ç†Ÿç»ƒäº shell è„šæœ¬ç¼–å†™ï¼Œä½ åº”è¯¥éƒ½å¬è¯´è¿‡è§åˆ°è¿‡ `#!/bin/bash` çš„æ–‡ä»¶å¤´ã€‚å®ƒè¢«ç§°ä½œä¸º Shebang/Hashbangï¼Œæ˜¯ç”±ä¸€ä¸ªäº•å·å’Œå¹å·æ„æˆçš„å­—ç¬¦åºåˆ—ã€‚

ä¸é™äº bash/zshï¼Œç±» Unix æ“ä½œç³»ç»Ÿçš„ Shell loader ä¼šåˆ†æ Shebang ä¹‹åçš„å†…å®¹å¹¶å°†å…¶ä½œä¸ºè§£é‡Šå™¨æŒ‡ä»¤è€Œè°ƒç”¨ã€‚

ä¾‹å¦‚å¯¹äºå¦‚ä¸‹çš„æ–‡ä»¶ï¼š

```bash
#!/bin/bash
echo "hello"
```

Shell ä¼šè¯†åˆ«åˆ° shebang å­—å¤´ï¼Œç„¶åå°†åç»§çš„ `/bin/bash` ä½œä¸ºè§£é‡Šå™¨ï¼Œå¹¶å‘ bash ä¼ é€’æ–‡ä»¶çš„å†…å®¹è¿›è¡Œæ‰§è¡Œã€‚æ‰€ä»¥ bash è§£é‡Šäº† `echo "hello"` ä¹‹ååœ¨æ§åˆ¶å°è¾“å‡ºäº† `hello` æ–‡æœ¬ã€‚





## Shebangï¼ŒHash-bang (#!)

Shebang ç”±ä¸€ä¸ªäº•å·å’Œå¹å·å¼€å¤´ï¼Œè¯·æ³¨æ„ï¼Œå¤šæ•° Shellï¼ˆsh/bash/zsh/fish/kshï¼‰ä¼šæœŸå¾…æ–‡ä»¶å¼€å¤´æœ‰é™å­—èŠ‚èŒƒå›´å†…ï¼Œåœ¨ç¬¬ä¸€è¡Œè¡Œé¦–èƒ½å¤Ÿè¯†åˆ«åˆ° Shebang åºåˆ—ï¼Œç„¶åè¿›å…¥ Shebang è§£é‡Šæ¨¡å¼ã€‚

åœ¨ `#!` åºåˆ—ä¹‹åå¯ä»¥æœ‰ 0 åˆ°å¤šä¸ªç©ºç™½å­—ç¬¦ï¼Œç„¶åæ˜¯è§£é‡Šå™¨çš„ç»å¯¹è·¯å¾„ï¼ˆå¯ä»¥ä¸ºå…¶æŒ‡å®šå‚æ•°ï¼‰ã€‚ä»ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦å¼€å§‹ï¼Œloader å°†ä¼šæœŸå¾…ä¸€è¡Œå®Œæ•´çš„å‘½ä»¤è¡Œæ–‡æœ¬ï¼Œå¹¶ä¼šå°†è¿™æ®µå‘½ä»¤è¡Œï¼ˆæ— è®ºæœ‰å¦å¸¦æœ‰å‚æ•°ï¼‰å½“ä½œè§£é‡Šå™¨æ‰§è¡Œï¼Œå¹¶ä¸ºè¯¥è§£é‡Šå™¨çš„æ ‡å‡†è¾“å…¥è®¾å¤‡ä¸­å†™å…¥è„šæœ¬æ–‡ä»¶çš„å†…å®¹ã€‚

> å¯¹äºç°ä»£çš„å¤§å¤šæ•° Shell ç¨‹åºæ¥è¯´ï¼Œå®ƒä»¬éƒ½æ˜¯ç®€å•åœ°å°†è„šæœ¬æ–‡ä»¶æœ¬èº«ä¼ é€’ç»™è§£é‡Šå™¨ï¼Œè€Œä¸æ˜¯å°†å»æ‰ Shebang line ä¹‹åçš„å†…å®¹ä¼ é€’ç»™è§£é‡Šå™¨ã€‚
>
> è¿™ä¸ªè¡Œä¸ºä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå› ä¸º Shebang loader çš„å®ç°è€…å°±æ— éœ€æ„å»ºè„šæœ¬æ–‡ä»¶çš„ç¼“å†²åŒºæ¥å»æ‰ Shebang line äº†ã€‚
>
> å¦‚æœæˆ‘æ˜¯ OS ä»¥åŠ Shell çš„ä½œè€…ï¼Œæˆ‘ä¼šè€ƒè™‘åœ¨ file system çš„æ”¯æ’‘èƒ½åŠ›ä¸Šæä¾›ä¸€ä¸ª mmap æœºåˆ¶ï¼Œè¿™ä¸ªå¢å¼ºå‹çš„ mmap èƒ½å¤ŸæŒ‡å®š (offset_start, offset_stop) æˆ–è€… (offset, length) çš„æ–¹å¼æ¥æ˜ å°„ä¸€ä¸ªè™šæ‹Ÿçš„æ–‡ä»¶å¥æŸ„ï¼ˆè™šæ‹Ÿçš„ inodeï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆè½»æ˜“åœ°å®ç°æ’é™¤ shebang line çš„ç®—æ³•äº†ã€‚
>
> > è¿™æ ·æœ‰æ„æ€å—ï¼Ÿ
> >
> > æœ‰çš„ã€‚
> >
> > å¯¹äºå¤šæ•°ç¼–è¯‘å™¨æ¥è¯´ï¼Œè¯­è¨€çš„è¯­æ³•å±‚é¢èƒ½å¤Ÿæ”¯æŒ # ä½œä¸ºå•è¡Œæ³¨é‡Šçš„ï¼Œå¹¶ä¸å¤šï¼Œä¾‹å¦‚ c++, golang, rust, scala, kotlin ç»Ÿç»Ÿéƒ½ä¸è¡Œã€‚
> >
> > è¿™å°±å¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼ŒæŠŠè¿™äº›ä¼ ç»Ÿå‹ç¼–è¯‘è¯­è¨€å‹çš„ç¼–è¯‘å™¨å½“ä½œè§£é‡Šå‹çš„è§£é‡Šå™¨ï¼Œåœ¨ä½ è§£å†³äº† shebang è¡ŒåŠ è½½é—®é¢˜ä¹‹åï¼Œä½ ä¼šé‡åˆ°ä¸èƒ½è¯†åˆ«çš„ '#' å­—ç¬¦é—®é¢˜ï¼Œè¿™æ˜¯å¾ˆæœ‰ç‚¹å“­ç¬‘ä¸å¾—çš„ã€‚
> >
> > ![image-20201211093217275](https://i.loli.net/2020/12/11/I7VnNa6FcbXP4y9.png)
> >
> > æ‰€ä»¥å¦‚æœ OS åœ¨ filesystem ä¸Šæä¾›è¿™æ ·çš„ç‰¹æ€§çš„è¯ï¼ŒShell å¼€å‘è€…å¯ä»¥å¾ˆè½»æ˜“åœ°è§£å†³æ‰ Shebang lineï¼Œè¿™æ ·åƒ go è¿™æ ·çš„ç¼–è¯‘å™¨å°±èƒ½å¤Ÿå¾ˆå¥½åœ°å¥‘åˆåˆ° Shell ä¸­äº†ã€‚
> >
> > > å½“å‰ï¼Œæœ€ç®€å•çš„ Golang åƒè§£é‡Šå™¨ä¸€æ ·å·¥ä½œçš„æ–¹å¼æ˜¯ï¼š
> > >
> > > ```bash
> > > go run a.go
> > > ```
> > >
> > > ä¹Ÿæœ‰ä¸€äº›æ–¹æ³•è¯•å›¾è§£å†³è¿™ä¸€é—®é¢˜ã€‚
> > >
> > > ç¨åç« èŠ‚æˆ‘ä»¬è¿˜ä¼šå±•å¼€ç ”è®¨è¿™ä¸ªé—®é¢˜ã€‚
> >
> > æˆ–è®¸è¿™ç§æœºåˆ¶ linux mmap å·²ç»èƒ½æ”¯æŒäº†ï¼Œå°šæœªå»æŸ¥é˜…è¿‡å…¶å˜è¿ã€‚

ç†è®ºä¸Šè¯´ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ª bash è„šæœ¬åˆ°è¿™é‡Œï¼Œå®ƒä¼šè¢«æ­£ç¡®åœ°å¥—å¨ƒã€‚

è€ŒæŒ‡å®šä¸€ä¸ª ELF å¯æ‰§è¡Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„åˆ°è¿™é‡Œæ˜¯æ¯”è¾ƒå¸¸è§çš„é€‰æ‹©ï¼Œæ­£å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š

```bash
#!/bin/bash
#!/bin/zsh
#!/bin/fish

#!/usr/bin/env bash
#!/usr/bin/env zsh

#!/usr/local/bin/my-prog
#!/usr/local/bin/my-script.sh
```

å…¶ä¸­ï¼Œä½¿ç”¨ `#!/usr/bin/env arg` æ˜¯ä¸€ç§å¸¸è§çš„åœ¨ä¸åŒå¹³å°ä¸Šéƒ½èƒ½æ­£ç¡®æ‰¾åˆ°è§£é‡Šå™¨çš„åŠæ³•ã€‚å› ä¸ºæœ‰çš„å¹³å°ä¸Š bash è¢«å®‰ç½®åœ¨ /binï¼Œæœ‰çš„å¹³å°ä¸Šå¯èƒ½æ˜¯å®‰ç½®åœ¨ /usr/binï¼Œæ‰€ä»¥ `/bin/bash` å¯èƒ½å¹¶ä¸æ˜¯æ€»æ˜¯èƒ½æ‰¾åˆ° bash çš„çœŸèº«ã€‚æ­¤æ—¶å€ŸåŠ© `/usr/bin/env bash` çš„æ–¹å¼ï¼Œå¹³å°ä¼šå°†è‡ªå·±çš„ bash å®‰ç½®ä½ç½®è¿”å›ç»™ Shebang loaderï¼Œè¿™å°±èƒ½ä¿è¯ bash äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶çš„å¯ç”¨æ€§ã€‚



### æ›´å¤šä¾‹å­

Perl å’Œ Python é€šå¸¸éƒ½æ˜¯ Linux å‘è¡Œç‰ˆä¸­çš„æ ‡é…ã€‚

æ‰€ä»¥ç›´æ¥ä½¿ç”¨å®ƒä»¬çš„è§£é‡Šè„šæœ¬åšå·¥å…·çš„ä¾‹å­ä¹Ÿå¾ˆå¤šã€‚è¿™æ—¶å€™çš„ Shebang å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š

```bash
#!/usr/bin/perl -w         # ä½¿ç”¨å¸¦è­¦å‘Šçš„Perlæ‰§è¡Œ
#!/usr/bin/python -O       # ä½¿ç”¨å…·æœ‰ä»£ç ä¼˜åŒ–çš„Pythonæ‰§è¡Œ
```

PHP ä¹Ÿæ”¯æŒè„šæœ¬åŒ–è¿è¡Œï¼Œä½ éœ€è¦ç”¨åˆ°ï¼š

```bash
#!/usr/bin/php             # ä½¿ç”¨PHPçš„å‘½ä»¤è¡Œè§£é‡Šå™¨æ‰§è¡Œ
```

Golang æ˜¯ä¸€ä¸ªæ¯” Python æ›´æœ‰åŠ›çš„è§£é‡Šå™¨å€™é€‰äººï¼Œä¸è¿‡è¿™è¾¹çš„ç§¯ç´¯è¿˜è¿œè¿œä¸å¤Ÿå‘èµ·æŒ‘æˆ˜ï¼Œä½ å¯ä»¥è¿™æ ·è·‘ Golang çš„è„šæœ¬ï¼š

```bash
#!/usr/bin/env bash
exec go run "$0" "$@"
!#
package main

import (
    "fmt"
    "os"
)

func main() {
    fmt.Println("Hello", os.Args[1])
    os.Exit(42)
}

```

ä½†å®ƒä¼šä»¥ä¸åˆé€‚çš„golang è¯­æ³•è€Œå‘Šç»ˆã€‚è¡Œå¾—é€šçš„åŠæ³•åœ¨ç¨åä¼šè¿›è¡Œè®¨è®ºã€‚

ä½† Scalaï¼ŒSchemeï¼ŒNodejs éƒ½èƒ½å¤Ÿè¾¾åˆ°è§£é‡Šè¿è¡Œçš„ç›®çš„ã€‚



### ä½¿ç”¨å…¶å®ƒæ‰§è¡Œæ–‡ä»¶è€Œä¸æ˜¯ bash

æ—¢ç„¶ Shebang loader æ˜¯åœ¨æ‰§è¡Œä¸€æ¡å‘½ä»¤è¡Œï¼Œé‚£ä¹ˆä½ å¹¶ä¸ä¸€å®šéè¦ä½¿ç”¨ bashã€‚

ä¾‹å¦‚å¯ä»¥ç”¨ cat è¯•è¯•ï¼š

```bash
#!/bin/cat
hello world
```





## bang-pound (!#) in Scala

`!#` æ˜¯ Scala ä¸“æœ‰çš„ä¸€ä¸ªè¯­æ³•å•ä½ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°† scala ç¼–è¯‘å™¨åˆ‡æ¢åˆ°è„šæœ¬è§£é‡Šæ¨¡å¼ã€‚æ‰€ä»¥ Scala çš„è„šæœ¬å¼€å‘è€…èƒ½å¤Ÿç¼–å†™[^7]ï¼š

```scala
#!/bin/sh
exec scala "$0" "$@"
!#
// Say hello to the first argument
println("Hello, "+ args(0) +"!")
```

å¯¹äº Scala æ¥è¯´ï¼Œå…¶è¯­æ³•åˆ†æä¼šå°† `#!` .. `!#` ä¹‹é—´çš„å†…å®¹å½“ä½œæ˜¯æ™®é€šæ³¨é‡Šä¸€èˆ¬åœ°ç•¥è¿‡ã€‚



[^7]: [What is the meaning of !# (bang-pound) in a sh / Bash shell script? - Stack Overflow](https://stackoverflow.com/questions/10060419/what-is-the-meaning-of-bang-pound-in-a-sh-bash-shell-script) 







## golang

è®© golang å·¥ä½œä¸ºè§£é‡Šå™¨ï¼Œæ˜¯ä¸ªä¸å®¹æ˜“çš„äº‹ã€‚

### hack

æˆ‘ä»¬å·²ç»çŸ¥é“ä¸€ç§ [hack æ–¹æ³•](https://posener.github.io/go-shebang-story/)[^9]ï¼ˆ[è¯‘æ–‡](https://www.infoq.cn/article/mbzyz8sedtbz5*4mhizo)[^10]ï¼Œ[Stackoverflow](https://stackoverflow.com/questions/41542941/is-it-possible-to-run-go-code-as-a-script)[^11]ï¼‰å¯ä»¥å¥æ•ˆï¼š

```go
//usr/bin/env go run "$0" "$@"; exit "$?"
package main

import (
    "fmt"
    "os"
)

func main() {
    fmt.Println("Hello", os.Args[1:])
    os.Exit(42)
}
```

### gorun

æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© [`gorun`](https://github.com/erning/gorun) æ¥é—´æ¥åœ°è·‘ .go å¦‚åŒè„šæœ¬ï¼š

```go
#! /usr/bin/env gorun
package main

import (
    "fmt"
    "os"
)

func main() {
    fmt.Println("Hello", os.Args[1:])
    os.Exit(42)
}
```

ç„¶åï¼š

```bash
./example.go world
```

è¿™ç§æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼Œ.go æ–‡ä»¶ä¸å†æ˜¯åˆæ³•æœ‰æ•ˆçš„ã€‚

è¿™ä¼šå¯¼è‡´ä¸€ç³»åˆ—çš„é—®é¢˜ã€‚ä½ åªèƒ½å°†è¿™äº› .go è„šæœ¬æ–‡ä»¶ç§»å‡ºä½ çš„ source-treeï¼Œå¦åˆ™ä½ çš„ Golang é¡¹ç›®è¿ gofmtï¼Œgo run éƒ½åšä¸äº†ã€‚

### ææ¡ˆ

è®© golang æ”¯æŒ '#' å•è¡Œæ³¨é‡Šæ˜¯ä¸ªå¾ˆå›°éš¾çš„äº‹å—ï¼ŸæŒ‰ç…§ Golang å¼€å‘é˜Ÿé‚£å †äººçš„æ€§å­ï¼Œè¿™å¾ˆå›°éš¾ï¼Œå› ä¸ºè¿™éœ€è¦è°ƒæ•´ç¼–è¯‘å™¨çš„è¯æ³•å’Œè¯­æ³•é€»è¾‘ï¼Œè¿˜ä¼šå½±å“åˆ° golang å·¥å…·æ ‘ä¸­çš„ä¸€ç³»åˆ—å·¥å…·ï¼Œgofmtï¼Œgoyacc ç­‰ç­‰ï¼Œè€Œä¸”æ‰€æœ‰çš„ç¬¬ä¸‰æ–¹å·¥å…·éƒ½ä¼šæ„Ÿè§‰ä¸å¥½äº†ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸ªä¸èƒ½è¢«æ¥å—çš„ææ¡ˆå˜›ã€‚

è®© Golang åƒ Nodejs é‚£æ ·ä¸“é—¨ä¸º Shebang line è¿›è¡Œä¸€ä¸ª hack æ€§å¤„ç†ï¼Œè¿™å›°éš¾å—ï¼Ÿæƒ³å¿…ä»ç„¶æ˜¯å¾ˆå›°éš¾çš„ï¼Œæ¯•ç«Ÿè¿™ä¼šå½±å“ go çš„ç¼–è¯‘é€Ÿåº¦å˜›ï¼



## ç»“è®º

æ‰€ä»¥æˆ‘åœ¨æƒ³ï¼Œæˆ‘åº”è¯¥è®¾è®¡ä¸€ç§è¯­è¨€ï¼Œæ²¡æœ‰è¿™äº›ç‹—å±çš„äº‹ï¼Œå“¦ï¼Œè¿˜è¦å†™ä¸ª OSï¼Œæ”¯æŒé‚£äº›æˆ‘è§‰å¾—å¾ˆæœ‰é“ç†çš„æ”¯æŒã€‚

æ˜å¹´å°± 2021 äº†ã€‚

æ¢¦ä»ç„¶æ²¡æœ‰é†’ã€‚



[^9]: [A Story About Writing Scripts with Go - Eyal Posener's Blog](https://posener.github.io/go-shebang-story/) 
[^10]:  [ä¸€æ¬¡ä½¿ç”¨Goè¯­è¨€ç¼–å†™è„šæœ¬çš„ç»å†-InfoQ](https://www.infoq.cn/article/mbzyz8sedtbz5*4mhizo) 
[^11]:  [Is it possible to run Go code as a script? - Stack Overflow](https://stackoverflow.com/questions/41542941/is-it-possible-to-run-go-code-as-a-script) 



## ğŸ”š



